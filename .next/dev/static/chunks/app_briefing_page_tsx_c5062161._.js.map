{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/collinsnnaji/VSCodeDevelopments/convivia24/app/briefing/page.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useRef, useEffect } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Send, Bot, User, Loader2 } from 'lucide-react';\n\ntype Message = { role: 'user' | 'assistant'; content: string };\n\nconst INITIAL_MESSAGE: Message = {\n  role: 'assistant',\n  content: \"Hi — I'm your AI Revenue Advisor. Ask me about pipeline health, sales audits, or how we can help. What's on your mind?\",\n};\n\nexport default function BriefingPage() {\n  const [messages, setMessages] = useState<Message[]>([INITIAL_MESSAGE]);\n  const [input, setInput] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [inquiryId, setInquiryId] = useState<string | null>(null);\n  const [streamingContent, setStreamingContent] = useState('');\n  const listRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    listRef.current?.scrollTo({ top: listRef.current.scrollHeight, behavior: 'smooth' });\n  }, [messages, streamingContent]);\n\n  async function handleSubmit(e: React.FormEvent) {\n    e.preventDefault();\n    const text = input.trim();\n    if (!text || loading) return;\n\n    const userMessage: Message = { role: 'user', content: text };\n    setMessages((prev) => [...prev, userMessage]);\n    setInput('');\n    setLoading(true);\n    setStreamingContent('');\n\n    try {\n      const res = await fetch('/api/chat', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          messages: [...messages, userMessage].map((m) => ({ role: m.role, content: m.content })),\n          inquiryId: inquiryId ?? undefined,\n        }),\n      });\n\n      if (!res.ok) {\n        const err = await res.json().catch(() => ({}));\n        throw new Error(err.error || `Request failed: ${res.status}`);\n      }\n\n      const reader = res.body?.getReader();\n      const decoder = new TextDecoder();\n      let buffer = '';\n      let streamedText = '';\n      const DATA_MARKER = '\\x00DATA:';\n\n      if (reader) {\n        while (true) {\n          const { done, value } = await reader.read();\n          if (done) break;\n          buffer += decoder.decode(value, { stream: true });\n          const idx = buffer.indexOf(DATA_MARKER);\n          if (idx !== -1) {\n            streamedText += buffer.slice(0, idx);\n            const jsonStr = buffer.slice(idx + DATA_MARKER.length).trim();\n            try {\n              const data = JSON.parse(jsonStr);\n              if (data.inquiryId) setInquiryId(data.inquiryId);\n            } catch {\n              // ignore\n            }\n            buffer = '';\n            break;\n          }\n          streamedText += buffer;\n          buffer = '';\n          setStreamingContent(streamedText);\n        }\n        if (buffer) {\n          const idx = buffer.indexOf(DATA_MARKER);\n          if (idx !== -1) {\n            streamedText += buffer.slice(0, idx);\n            try {\n              const data = JSON.parse(buffer.slice(idx + DATA_MARKER.length).trim());\n              if (data.inquiryId) setInquiryId(data.inquiryId);\n            } catch {\n              // ignore\n            }\n          } else {\n            streamedText += buffer;\n          }\n          setStreamingContent(streamedText);\n        }\n      }\n\n      const finalText = streamedText.trim();\n      if (finalText) setMessages((prev) => [...prev, { role: 'assistant', content: finalText }]);\n      setStreamingContent('');\n    } catch (err) {\n      setMessages((prev) => [\n        ...prev,\n        { role: 'assistant', content: `Sorry, something went wrong. ${err instanceof Error ? err.message : 'Please try again.'}` },\n      ]);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  const displayMessages = streamingContent\n    ? [...messages, { role: 'assistant' as const, content: streamingContent }]\n    : messages;\n\n  return (\n    <div className=\"min-h-screen bg-white overflow-x-hidden\">\n      <section className=\"pt-28 pb-6 px-4 md:px-6 border-b border-zinc-100\">\n        <div className=\"max-w-2xl mx-auto\">\n          <motion.p\n            initial={{ opacity: 0, y: 8 }}\n            animate={{ opacity: 1, y: 0 }}\n            className=\"text-[10px] font-semibold uppercase tracking-widest text-red-700 mb-2\"\n          >\n            Live chat\n          </motion.p>\n          <motion.h1\n            initial={{ opacity: 0, y: 8 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ delay: 0.05 }}\n            className=\"text-3xl md:text-4xl font-black tracking-tight text-zinc-900\"\n          >\n            AI Revenue Advisor\n          </motion.h1>\n          <motion.p\n            initial={{ opacity: 0, y: 8 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ delay: 0.1 }}\n            className=\"text-sm text-zinc-500 mt-1\"\n          >\n            Chat with our AI agent. Your conversation is saved so we can follow up.\n          </motion.p>\n        </div>\n      </section>\n\n      <section className=\"max-w-2xl mx-auto px-4 md:px-6 py-6\">\n        <div\n          ref={listRef}\n          className=\"min-h-[320px] max-h-[55vh] overflow-y-auto space-y-4 pb-4\"\n        >\n          <AnimatePresence initial={false}>\n            {displayMessages.map((msg, i) => (\n              <motion.div\n                key={i}\n                initial={{ opacity: 0, y: 8 }}\n                animate={{ opacity: 1, y: 0 }}\n                className={`flex gap-3 ${msg.role === 'user' ? 'flex-row-reverse' : ''}`}\n              >\n                <div\n                  className={`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${\n                    msg.role === 'user' ? 'bg-zinc-800 text-white' : 'bg-red-700 text-white'\n                  }`}\n                >\n                  {msg.role === 'user' ? <User size={16} /> : <Bot size={16} />}\n                </div>\n                <div\n                  className={`max-w-[85%] rounded-lg px-4 py-3 text-sm ${\n                    msg.role === 'user'\n                      ? 'bg-zinc-900 text-white'\n                      : 'bg-zinc-100 text-zinc-900 border border-zinc-200'\n                  }`}\n                >\n                  <p className=\"whitespace-pre-wrap break-words\">{msg.content}</p>\n                  {msg.role === 'assistant' && i === displayMessages.length - 1 && loading && (\n                    <span className=\"inline-block w-2 h-4 ml-0.5 bg-red-600 animate-pulse\" />\n                  )}\n                </div>\n              </motion.div>\n            ))}\n          </AnimatePresence>\n        </div>\n\n        <form onSubmit={handleSubmit} className=\"flex gap-2 mt-4\">\n          <input\n            type=\"text\"\n            value={input}\n            onChange={(e) => setInput(e.target.value)}\n            placeholder=\"Type your message...\"\n            className=\"flex-1 px-4 py-3 border border-zinc-300 rounded-lg text-zinc-900 placeholder-zinc-400 focus:outline-none focus:ring-2 focus:ring-red-600 focus:border-transparent\"\n            disabled={loading}\n          />\n          <button\n            type=\"submit\"\n            disabled={loading || !input.trim()}\n            className=\"px-4 py-3 bg-red-700 text-white rounded-lg font-semibold hover:bg-red-800 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\n          >\n            {loading ? <Loader2 size={18} className=\"animate-spin\" /> : <Send size={18} />}\n            Send\n          </button>\n        </form>\n\n        {inquiryId && (\n          <p className=\"text-[10px] uppercase tracking-widest text-zinc-400 mt-3\">\n            Conversation saved. We’ll follow up if you shared your details.\n          </p>\n        )}\n      </section>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;;;;;;;AAEA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;;;;;;;;;AAJA;;;;AAQA,IAAM,kBAA2B;IAC/B,MAAM;IACN,SAAS;AACX;AAEe,SAAS;;;IACtB,IAAgC,qLAAA,IAAA,yKAAQ,EAAY;QAAC;KAAgB,OAA9D,WAAyB,cAAf,cAAe;IAChC,IAA0B,sLAAA,IAAA,yKAAQ,EAAC,SAA5B,QAAmB,eAAZ,WAAY;IAC1B,IAA8B,sLAAA,IAAA,yKAAQ,EAAC,YAAhC,UAAuB,eAAd,aAAc;IAC9B,IAAkC,sLAAA,IAAA,yKAAQ,EAAgB,WAAnD,YAA2B,eAAhB,eAAgB;IAClC,IAAgD,sLAAA,IAAA,yKAAQ,EAAC,SAAlD,mBAAyC,eAAvB,sBAAuB;IAChD,IAAM,UAAU,IAAA,uKAAM,EAAiB;IAEvC,IAAA,0KAAS;kCAAC;gBACR;aAAA,mBAAA,QAAQ,OAAO,cAAf,uCAAA,iBAAiB,QAAQ,CAAC;gBAAE,KAAK,QAAQ,OAAO,CAAC,YAAY;gBAAE,UAAU;YAAS;QACpF;iCAAG;QAAC;QAAU;KAAiB;IAE/B,SAAe,aAAa,CAAkB;;gBAEtC,MAGA,aAqBW,WAdT,KAUE,KAIF,QACA,SACF,QACA,cACE,aAIsB,MAAhB,MAAM,OAGR,KAGE,SAEE,MAaJ,MAII,OAYR,WAGC;;;;wBAzET,EAAE,cAAc;wBACV,OAAO,MAAM,IAAI;wBACvB,IAAI,CAAC,QAAQ,SAAS;;;wBAEhB,cAAuB;4BAAE,MAAM;4BAAQ,SAAS;wBAAK;wBAC3D,YAAY,SAAC;mCAAS,AAAC,6KAAG,aAAJ;gCAAU;6BAAY;;wBAC5C,SAAS;wBACT,WAAW;wBACX,oBAAoB;;;;;;;;;wBAGN;;4BAAM,MAAM,aAAa;gCACnC,QAAQ;gCACR,SAAS;oCAAE,gBAAgB;gCAAmB;gCAC9C,MAAM,KAAK,SAAS,CAAC;oCACnB,UAAU,AAAC,6KAAG;wCAAU;uCAAa,GAAG,CAAC,SAAC;+CAAO;4CAAE,MAAM,EAAE,IAAI;4CAAE,SAAS,EAAE,OAAO;wCAAC;;oCACpF,WAAW,sBAAA,uBAAA,YAAa;gCAC1B;4BACF;;;wBAPM,MAAM;6BASR,CAAC,IAAI,EAAE,EAAP;;;;wBACU;;4BAAM,IAAI,IAAI,GAAG,KAAK,CAAC;uCAAO,CAAC;;;;wBAArC,MAAM;wBACZ,MAAM,IAAI,MAAM,IAAI,KAAK,IAAI,AAAC,mBAA6B,OAAX,IAAI,MAAM;;wBAGtD,UAAS,YAAA,IAAI,IAAI,cAAR,gCAAA,UAAU,SAAS;wBAC5B,UAAU,IAAI;wBAChB,SAAS;wBACT,eAAe;wBACb,cAAc;6BAEhB,QAAA;;;;;;;;wBAEwB;;4BAAM,OAAO,IAAI;;;wBAAjB,OAAA,eAAhB,OAAgB,KAAhB,MAAM,QAAU,KAAV;wBACd,IAAI,MAAM;;;;wBACV,UAAU,QAAQ,MAAM,CAAC,OAAO;4BAAE,QAAQ;wBAAK;wBACzC,MAAM,OAAO,OAAO,CAAC;wBAC3B,IAAI,QAAQ,CAAC,GAAG;4BACd,gBAAgB,OAAO,KAAK,CAAC,GAAG;4BAC1B,UAAU,OAAO,KAAK,CAAC,MAAM,YAAY,MAAM,EAAE,IAAI;4BAC3D,IAAI;gCACI,OAAO,KAAK,KAAK,CAAC;gCACxB,IAAI,KAAK,SAAS,EAAE,aAAa,KAAK,SAAS;4BACjD,EAAE,UAAM;4BACN,SAAS;4BACX;4BACA,SAAS;4BACT;;;;wBACF;wBACA,gBAAgB;wBAChB,SAAS;wBACT,oBAAoB;;;;;;wBAEtB,IAAI,QAAQ;4BACJ,OAAM,OAAO,OAAO,CAAC;4BAC3B,IAAI,SAAQ,CAAC,GAAG;gCACd,gBAAgB,OAAO,KAAK,CAAC,GAAG;gCAChC,IAAI;oCACI,QAAO,KAAK,KAAK,CAAC,OAAO,KAAK,CAAC,OAAM,YAAY,MAAM,EAAE,IAAI;oCACnE,IAAI,MAAK,SAAS,EAAE,aAAa,MAAK,SAAS;gCACjD,EAAE,UAAM;gCACN,SAAS;gCACX;4BACF,OAAO;gCACL,gBAAgB;4BAClB;4BACA,oBAAoB;wBACtB;;;wBAGI,YAAY,aAAa,IAAI;wBACnC,IAAI,WAAW,YAAY,SAAC;mCAAS,AAAC,6KAAG,aAAJ;gCAAU;oCAAE,MAAM;oCAAa,SAAS;gCAAU;6BAAE;;wBACzF,oBAAoB;;;;;;wBACb;wBACP,YAAY,SAAC;mCAAS,AACpB,6KAAG,aADiB;gCAEpB;oCAAE,MAAM;oCAAa,SAAS,AAAC,gCAAwF,OAAzD,IAAG,8JAAY,EAAf,MAAe,SAAQ,KAAI,OAAO,GAAG;gCAAsB;6BAC1H;;;;;;;wBAED,WAAW;;;;;;;;;;QAEf;;IAEA,IAAM,kBAAkB,mBACpB,AAAC,6KAAG,iBAAJ;QAAc;YAAE,MAAM;YAAsB,SAAS;QAAiB;KAAE,IACxE;IAEJ,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAQ,WAAU;0BACjB,cAAA,6LAAC;oBAAI,WAAU;;sCACb,6LAAC,uMAAM,CAAC,CAAC;4BACP,SAAS;gCAAE,SAAS;gCAAG,GAAG;4BAAE;4BAC5B,SAAS;gCAAE,SAAS;gCAAG,GAAG;4BAAE;4BAC5B,WAAU;sCACX;;;;;;sCAGD,6LAAC,uMAAM,CAAC,EAAE;4BACR,SAAS;gCAAE,SAAS;gCAAG,GAAG;4BAAE;4BAC5B,SAAS;gCAAE,SAAS;gCAAG,GAAG;4BAAE;4BAC5B,YAAY;gCAAE,OAAO;4BAAK;4BAC1B,WAAU;sCACX;;;;;;sCAGD,6LAAC,uMAAM,CAAC,CAAC;4BACP,SAAS;gCAAE,SAAS;gCAAG,GAAG;4BAAE;4BAC5B,SAAS;gCAAE,SAAS;gCAAG,GAAG;4BAAE;4BAC5B,YAAY;gCAAE,OAAO;4BAAI;4BACzB,WAAU;sCACX;;;;;;;;;;;;;;;;;0BAML,6LAAC;gBAAQ,WAAU;;kCACjB,6LAAC;wBACC,KAAK;wBACL,WAAU;kCAEV,cAAA,6LAAC,+MAAe;4BAAC,SAAS;sCACvB,gBAAgB,GAAG,CAAC,SAAC,KAAK;qDACzB,6LAAC,uMAAM,CAAC,GAAG;oCAET,SAAS;wCAAE,SAAS;wCAAG,GAAG;oCAAE;oCAC5B,SAAS;wCAAE,SAAS;wCAAG,GAAG;oCAAE;oCAC5B,WAAW,AAAC,cAA2D,OAA9C,IAAI,IAAI,KAAK,SAAS,qBAAqB;;sDAEpE,6LAAC;4CACC,WAAW,AAAC,uEAEX,OADC,IAAI,IAAI,KAAK,SAAS,2BAA2B;sDAGlD,IAAI,IAAI,KAAK,uBAAS,6LAAC,6MAAI;gDAAC,MAAM;;;;;sEAAS,6LAAC,0MAAG;gDAAC,MAAM;;;;;;;;;;;sDAEzD,6LAAC;4CACC,WAAW,AAAC,4CAIX,OAHC,IAAI,IAAI,KAAK,SACT,2BACA;;8DAGN,6LAAC;oDAAE,WAAU;8DAAmC,IAAI,OAAO;;;;;;gDAC1D,IAAI,IAAI,KAAK,eAAe,MAAM,gBAAgB,MAAM,GAAG,KAAK,yBAC/D,6LAAC;oDAAK,WAAU;;;;;;;;;;;;;mCArBf;;;;;;;;;;;;;;;;kCA6Bb,6LAAC;wBAAK,UAAU;wBAAc,WAAU;;0CACtC,6LAAC;gCACC,MAAK;gCACL,OAAO;gCACP,UAAU,SAAC;2CAAM,SAAS,EAAE,MAAM,CAAC,KAAK;;gCACxC,aAAY;gCACZ,WAAU;gCACV,UAAU;;;;;;0CAEZ,6LAAC;gCACC,MAAK;gCACL,UAAU,WAAW,CAAC,MAAM,IAAI;gCAChC,WAAU;;oCAET,wBAAU,6LAAC,+NAAO;wCAAC,MAAM;wCAAI,WAAU;;;;;6DAAoB,6LAAC,6MAAI;wCAAC,MAAM;;;;;;oCAAO;;;;;;;;;;;;;oBAKlF,2BACC,6LAAC;wBAAE,WAAU;kCAA2D;;;;;;;;;;;;;;;;;;AAOlF;GAlMwB;KAAA"}}]
}