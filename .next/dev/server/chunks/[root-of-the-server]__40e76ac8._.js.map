{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/collinsnnaji/VSCodeDevelopments/convivia24/lib/auth/server.ts"],"sourcesContent":["import { createNeonAuth } from '@neondatabase/auth/next/server';\n\nexport function getAuth() {\n  return createNeonAuth({\n    baseUrl: process.env.NEON_AUTH_BASE_URL!,\n    cookies: {\n      secret: process.env.NEON_AUTH_COOKIE_SECRET!,\n    },\n  });\n}\n\n// Normalize Neon's { data, error } so session?.user works everywhere (dashboard, API routes)\nasync function getSessionNormalized() {\n  const { data } = await getAuth().getSession();\n  const user = data?.user ?? (data as any)?.session?.user;\n  if (!user) return null;\n  return { ...data, user } as { user: { id: string; email?: string | null; name?: string | null; image?: string | null }; [k: string]: unknown };\n}\n\n// Convenience alias â€” call getAuth() in request handlers, not at module level\nexport const auth = {\n  getSession: getSessionNormalized,\n  handler: () => getAuth().handler(),\n  middleware: (config?: { loginUrl?: string }) => getAuth().middleware(config),\n};\n"],"names":[],"mappings":";;;;;;AAAA;;AAEO,SAAS;IACd,OAAO,IAAA,8LAAc,EAAC;QACpB,SAAS,QAAQ,GAAG,CAAC,kBAAkB;QACvC,SAAS;YACP,QAAQ,QAAQ,GAAG,CAAC,uBAAuB;QAC7C;IACF;AACF;AAEA,6FAA6F;AAC7F,eAAe;IACb,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,UAAU,UAAU;IAC3C,MAAM,OAAO,MAAM,QAAS,MAAc,SAAS;IACnD,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO;QAAE,GAAG,IAAI;QAAE;IAAK;AACzB;AAGO,MAAM,OAAO;IAClB,YAAY;IACZ,SAAS,IAAM,UAAU,OAAO;IAChC,YAAY,CAAC,SAAmC,UAAU,UAAU,CAAC;AACvE"}},
    {"offset": {"line": 111, "column": 0}, "map": {"version":3,"sources":["file:///Users/collinsnnaji/VSCodeDevelopments/convivia24/app/api/documents/presign/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { auth } from '@/lib/auth/server';\nimport { S3Client, PutObjectCommand } from '@aws-sdk/client-s3';\nimport { getSignedUrl } from '@aws-sdk/s3-request-presigner';\nimport { randomUUID } from 'crypto';\n\nfunction getS3Client() {\n  const endpoint = process.env.IDRIVE_ENDPOINT;\n  const accessKey = process.env.IDRIVE_ACCESS_KEY;\n  const secretKey = process.env.IDRIVE_SECRET_KEY;\n  const bucket = process.env.IDRIVE_BUCKET;\n  if (!endpoint || !accessKey || !secretKey || !bucket) {\n    throw new Error('IDRIVE_ENDPOINT, IDRIVE_ACCESS_KEY, IDRIVE_SECRET_KEY, and IDRIVE_BUCKET must be set');\n  }\n  // iDrive e2: region must match endpoint. Examples: eu-west-3 (Paris), eu-west-2 (London-2), uk-1 (London)\n  const regionMatch = endpoint.match(/s3\\.([a-z0-9-]+)\\.idrivee2\\.com/i);\n  const region = process.env.IDRIVE_REGION ?? regionMatch?.[1] ?? 'us-east-1';\n  return new S3Client({\n    endpoint: `https://${endpoint}`,\n    region,\n    credentials: { accessKeyId: accessKey, secretAccessKey: secretKey },\n    forcePathStyle: true,\n  });\n}\n\nexport async function POST(req: NextRequest) {\n  const session = await auth.getSession();\n  if (!session?.user) return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });\n\n  const endpoint = process.env.IDRIVE_ENDPOINT;\n  const bucket = process.env.IDRIVE_BUCKET;\n  if (!endpoint || !bucket || !process.env.IDRIVE_ACCESS_KEY || !process.env.IDRIVE_SECRET_KEY) {\n    return NextResponse.json(\n      { error: 'Storage not configured. Set IDRIVE_ENDPOINT, IDRIVE_BUCKET, IDRIVE_ACCESS_KEY, IDRIVE_SECRET_KEY.' },\n      { status: 503 }\n    );\n  }\n\n  let body: { name?: string; type?: string; size?: number };\n  try {\n    body = await req.json();\n  } catch {\n    return NextResponse.json({ error: 'Invalid JSON body' }, { status: 400 });\n  }\n  const { name, type, size } = body;\n  if (!name || !type) return NextResponse.json({ error: 'Missing name or type' }, { status: 400 });\n\n  const ext = name.split('.').pop() || 'bin';\n  const key = `${randomUUID()}.${ext}`;\n\n  try {\n    const s3 = getS3Client();\n    const command = new PutObjectCommand({\n      Bucket: bucket,\n      Key: key,\n      ContentType: type,\n      ...(size != null && size > 0 && { ContentLength: size }),\n    });\n    const uploadUrl = await getSignedUrl(s3, command, { expiresIn: 300 });\n    return NextResponse.json({ uploadUrl, key });\n  } catch (err: unknown) {\n    const message = err instanceof Error ? err.message : 'Failed to generate upload URL';\n    console.error('[presign]', err);\n    return NextResponse.json({ error: message }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAEA,SAAS;IACP,MAAM,WAAW,QAAQ,GAAG,CAAC,eAAe;IAC5C,MAAM,YAAY,QAAQ,GAAG,CAAC,iBAAiB;IAC/C,MAAM,YAAY,QAAQ,GAAG,CAAC,iBAAiB;IAC/C,MAAM,SAAS,QAAQ,GAAG,CAAC,aAAa;IACxC,IAAI,CAAC,YAAY,CAAC,aAAa,CAAC,aAAa,CAAC,QAAQ;QACpD,MAAM,IAAI,MAAM;IAClB;IACA,0GAA0G;IAC1G,MAAM,cAAc,SAAS,KAAK,CAAC;IACnC,MAAM,SAAS,QAAQ,GAAG,CAAC,aAAa,IAAI,aAAa,CAAC,EAAE,IAAI;IAChE,OAAO,IAAI,gOAAQ,CAAC;QAClB,UAAU,CAAC,QAAQ,EAAE,UAAU;QAC/B;QACA,aAAa;YAAE,aAAa;YAAW,iBAAiB;QAAU;QAClE,gBAAgB;IAClB;AACF;AAEO,eAAe,KAAK,GAAgB;IACzC,MAAM,UAAU,MAAM,+HAAI,CAAC,UAAU;IACrC,IAAI,CAAC,SAAS,MAAM,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAe,GAAG;QAAE,QAAQ;IAAI;IAEtF,MAAM,WAAW,QAAQ,GAAG,CAAC,eAAe;IAC5C,MAAM,SAAS,QAAQ,GAAG,CAAC,aAAa;IACxC,IAAI,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,GAAG,CAAC,iBAAiB,IAAI,CAAC,QAAQ,GAAG,CAAC,iBAAiB,EAAE;QAC5F,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAoG,GAC7G;YAAE,QAAQ;QAAI;IAElB;IAEA,IAAI;IACJ,IAAI;QACF,OAAO,MAAM,IAAI,IAAI;IACvB,EAAE,OAAM;QACN,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAoB,GAAG;YAAE,QAAQ;QAAI;IACzE;IACA,MAAM,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,EAAE,GAAG;IAC7B,IAAI,CAAC,QAAQ,CAAC,MAAM,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAuB,GAAG;QAAE,QAAQ;IAAI;IAE9F,MAAM,MAAM,KAAK,KAAK,CAAC,KAAK,GAAG,MAAM;IACrC,MAAM,MAAM,GAAG,IAAA,mHAAU,IAAG,CAAC,EAAE,KAAK;IAEpC,IAAI;QACF,MAAM,KAAK;QACX,MAAM,UAAU,IAAI,wOAAgB,CAAC;YACnC,QAAQ;YACR,KAAK;YACL,aAAa;YACb,GAAI,QAAQ,QAAQ,OAAO,KAAK;gBAAE,eAAe;YAAK,CAAC;QACzD;QACA,MAAM,YAAY,MAAM,IAAA,0MAAY,EAAC,IAAI,SAAS;YAAE,WAAW;QAAI;QACnE,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;YAAW;QAAI;IAC5C,EAAE,OAAO,KAAc;QACrB,MAAM,UAAU,eAAe,QAAQ,IAAI,OAAO,GAAG;QACrD,QAAQ,KAAK,CAAC,aAAa;QAC3B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAQ,GAAG;YAAE,QAAQ;QAAI;IAC7D;AACF"}}]
}