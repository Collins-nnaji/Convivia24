{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///Users/collinsnnaji/VSCodeDevelopments/convivia24/app/admin/listings/ListingsFilters.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ListingsFilters = registerClientReference(\n    function() { throw new Error(\"Attempted to call ListingsFilters() from the server but ListingsFilters is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/admin/listings/ListingsFilters.tsx <module evaluation>\",\n    \"ListingsFilters\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;AACO,MAAM,kBAAkB,IAAA,wQAAuB,EAClD;IAAa,MAAM,IAAI,MAAM;AAA8O,GAC3Q,wEACA","ignoreList":[0]}},
    {"offset": {"line": 32, "column": 0}, "map": {"version":3,"sources":["file:///Users/collinsnnaji/VSCodeDevelopments/convivia24/app/admin/listings/ListingsFilters.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ListingsFilters = registerClientReference(\n    function() { throw new Error(\"Attempted to call ListingsFilters() from the server but ListingsFilters is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/admin/listings/ListingsFilters.tsx\",\n    \"ListingsFilters\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;AACO,MAAM,kBAAkB,IAAA,wQAAuB,EAClD;IAAa,MAAM,IAAI,MAAM;AAA8O,GAC3Q,oDACA","ignoreList":[0]}},
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 54, "column": 0}, "map": {"version":3,"sources":["file:///Users/collinsnnaji/VSCodeDevelopments/convivia24/app/admin/listings/page.tsx"],"sourcesContent":["import { requireAdmin } from '@/lib/auth/session';\nimport sql from '@/lib/db';\nimport Link from 'next/link';\nimport { ListingsFilters } from './ListingsFilters';\n\nexport default async function AdminListingsPage(props: { searchParams: Promise<{ client_id?: string; status?: string }> }) {\n  await requireAdmin();\n  const searchParams = await props.searchParams;\n  const clientId = searchParams.client_id ?? null;\n  const status = searchParams.status ?? null;\n\n  const clients = await sql`SELECT id, name FROM clients ORDER BY name`;\n\n  let listings: Record<string, unknown>[];\n  if (clientId && status) {\n    listings = (await sql`\n      SELECT l.*, c.name as client_name\n      FROM listings l\n      JOIN clients c ON c.id = l.client_id\n      WHERE l.client_id = ${clientId} AND l.status = ${status}\n      ORDER BY l.updated_at DESC\n    `) as Record<string, unknown>[];\n  } else if (clientId) {\n    listings = (await sql`\n      SELECT l.*, c.name as client_name\n      FROM listings l\n      JOIN clients c ON c.id = l.client_id\n      WHERE l.client_id = ${clientId}\n      ORDER BY l.updated_at DESC\n    `) as Record<string, unknown>[];\n  } else if (status) {\n    listings = (await sql`\n      SELECT l.*, c.name as client_name\n      FROM listings l\n      JOIN clients c ON c.id = l.client_id\n      WHERE l.status = ${status}\n      ORDER BY l.updated_at DESC\n    `) as Record<string, unknown>[];\n  } else {\n    listings = (await sql`\n      SELECT l.*, c.name as client_name\n      FROM listings l\n      JOIN clients c ON c.id = l.client_id\n      ORDER BY l.updated_at DESC\n    `) as Record<string, unknown>[];\n  }\n\n  const STATUS_LABELS: Record<string, string> = {\n    draft: 'Draft',\n    submitted: 'Submitted',\n    price_agreed: 'Price agreed',\n    listed: 'Listed',\n    sold: 'Sold',\n    withdrawn: 'Withdrawn',\n  };\n\n  function formatPrice(value: unknown, currency: string): string {\n    if (value == null || value === '') return '—';\n    const n = typeof value === 'string' ? parseFloat(value) : Number(value);\n    if (isNaN(n)) return '—';\n    return `${currency === 'GBP' ? '£' : currency + ' '}${n.toLocaleString()}`;\n  }\n\n  function relativeDate(dateStr: string): string {\n    const d = new Date(dateStr);\n    const now = new Date();\n    const diffMs = now.getTime() - d.getTime();\n    const diffDays = Math.floor(diffMs / (24 * 60 * 60 * 1000));\n    if (diffDays === 0) return 'Today';\n    if (diffDays === 1) return 'Yesterday';\n    if (diffDays < 7) return `${diffDays} days ago`;\n    if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;\n    return d.toLocaleDateString('en-GB');\n  }\n\n  const countDraft = listings.filter((l) => String(l.status) === 'draft').length;\n  const countInProgress = listings.filter((l) => ['submitted', 'price_agreed', 'listed'].includes(String(l.status))).length;\n  const countSold = listings.filter((l) => String(l.status) === 'sold').length;\n\n  return (\n    <div className=\"p-8\">\n      <div className=\"mb-8\">\n        <span className=\"inline-block bg-red-600 text-white text-[9px] font-black uppercase tracking-[0.2em] px-2 py-1 mb-3\">\n          Listings\n        </span>\n        <h1 className=\"text-3xl font-black tracking-tighter text-zinc-900 uppercase italic\">\n          Items to sell\n        </h1>\n        <p className=\"text-zinc-600 text-sm mt-1\">\n          Partner listings: agree price and commission in Messages, then set agreed terms and mark sold here.\n        </p>\n      </div>\n\n      <ListingsFilters clients={clients as { id: string; name: string }[]} currentClientId={clientId} currentStatus={status} />\n\n      {listings.length > 0 && (\n        <div className=\"flex flex-wrap gap-4 mt-4 mb-3 text-sm\">\n          <span className=\"text-zinc-600\">\n            <strong className=\"text-zinc-900\">{listings.length}</strong> showing\n          </span>\n          {countDraft > 0 && <span className=\"text-zinc-500\">{countDraft} draft</span>}\n          {countInProgress > 0 && <span className=\"text-zinc-500\">{countInProgress} in progress</span>}\n          {countSold > 0 && <span className=\"text-zinc-500\">{countSold} sold</span>}\n        </div>\n      )}\n\n      <div className=\"bg-white border border-zinc-200 shadow-sm rounded-lg overflow-hidden mt-2\">\n        {listings.length === 0 ? (\n          <p className=\"text-zinc-500 text-sm text-center py-12\">No listings match the filters.</p>\n        ) : (\n          <div className=\"divide-y divide-zinc-100\">\n            {listings.map((l) => (\n              <Link\n                key={String(l.id)}\n                href={`/admin/listings/${l.id}`}\n                className=\"flex flex-wrap items-center justify-between gap-4 px-6 py-4 hover:bg-zinc-50 transition-colors\"\n              >\n                <div className=\"min-w-0\">\n                  <div className=\"flex flex-wrap items-center gap-2 mb-0.5\">\n                    <p className=\"text-sm font-semibold text-zinc-900 truncate\">{String(l.title)}</p>\n                    <span className=\"text-[10px] text-zinc-500 shrink-0\">{relativeDate(String(l.updated_at))}</span>\n                  </div>\n                  <p className=\"text-[11px] text-zinc-500 truncate\">{String(l.client_name)}</p>\n                  <div className=\"flex flex-wrap gap-3 mt-1 text-[11px] text-zinc-500\">\n                    <span>Asking: {formatPrice(l.asking_price, String(l.currency ?? 'GBP'))}</span>\n                    {l.agreed_price != null && l.agreed_price !== '' && (\n                      <span>Agreed: {formatPrice(l.agreed_price, String(l.currency ?? 'GBP'))}</span>\n                    )}\n                    {l.agreed_commission_pct != null && l.agreed_commission_pct !== '' && (\n                      <span>Commission: {Number(l.agreed_commission_pct)}%</span>\n                    )}\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-3\">\n                  <span className=\"text-[10px] font-black uppercase px-2 py-0.5 rounded bg-zinc-200 text-zinc-700\">\n                    {STATUS_LABELS[String(l.status)] ?? String(l.status)}\n                  </span>\n                  <span className=\"text-zinc-400\">→</span>\n                </div>\n              </Link>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}