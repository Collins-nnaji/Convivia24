{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///Users/collinsnnaji/VSCodeDevelopments/convivia24/app/admin/messages/page.tsx"],"sourcesContent":["import { requireAdmin } from '@/lib/auth/session';\nimport sql from '@/lib/db';\nimport Link from 'next/link';\nimport { MessageSquare } from 'lucide-react';\n\nexport default async function AdminMessagesPage() {\n  await requireAdmin();\n\n  // Get all clients with their latest message and unread count\n  const threads = await sql`\n    SELECT\n      c.id,\n      c.name,\n      MAX(m.created_at) as last_message_at,\n      COUNT(m.id) FILTER (WHERE m.sender_role = 'client' AND m.read_at IS NULL) as unread_count,\n      (SELECT body FROM messages m2 WHERE m2.client_id = c.id ORDER BY m2.created_at DESC LIMIT 1) as last_body\n    FROM clients c\n    LEFT JOIN messages m ON m.client_id = c.id\n    GROUP BY c.id, c.name\n    HAVING COUNT(m.id) > 0\n    ORDER BY last_message_at DESC NULLS LAST\n  `;\n\n  return (\n    <div className=\"p-8 max-w-3xl\">\n      <div className=\"mb-8\">\n        <span className=\"inline-block bg-red-600 text-white text-[9px] font-black uppercase tracking-[0.2em] px-2 py-1 mb-3 rounded\">\n          Messages\n        </span>\n        <h1 className=\"text-3xl font-black tracking-tighter text-zinc-900 uppercase italic\">\n          All Threads\n        </h1>\n        <p className=\"text-zinc-600 text-sm mt-1\">{threads.length} active conversation{threads.length !== 1 ? 's' : ''}</p>\n      </div>\n\n      <div className=\"bg-white border border-zinc-200 shadow-sm rounded-lg overflow-hidden\">\n        {threads.length === 0 && (\n          <p className=\"text-zinc-500 text-sm text-center py-12\">No messages yet</p>\n        )}\n        <div className=\"divide-y divide-zinc-100\">\n          {threads.map((t: any) => (\n            <Link key={t.id} href={`/admin/clients/${t.id}`}\n              className=\"group flex items-center justify-between px-6 py-4 hover:bg-zinc-50 transition-colors\">\n              <div className=\"flex items-center gap-3 min-w-0\">\n                <div className=\"relative shrink-0\">\n                  <div className=\"w-9 h-9 bg-red-600 flex items-center justify-center text-white text-sm font-black rounded\">\n                    {t.name[0].toUpperCase()}\n                  </div>\n                  {parseInt(t.unread_count) > 0 && (\n                    <span className=\"absolute -top-1 -right-1 bg-red-600 text-white text-[9px] font-black rounded-full w-4 h-4 flex items-center justify-center\">\n                      {t.unread_count}\n                    </span>\n                  )}\n                </div>\n                <div className=\"min-w-0\">\n                  <p className=\"text-sm font-semibold text-zinc-900\">{t.name}</p>\n                  {t.last_body && (\n                    <p className=\"text-[11px] text-zinc-500 truncate\">{t.last_body}</p>\n                  )}\n                </div>\n              </div>\n              <div className=\"shrink-0 ml-4 text-right\">\n                {t.last_message_at && (\n                  <p className=\"text-[10px] text-zinc-500\">\n                    {new Date(t.last_message_at).toLocaleDateString('en-GB', { day: 'numeric', month: 'short' })}\n                  </p>\n                )}\n              </div>\n            </Link>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;;;;;AAGe,eAAe;IAC5B,MAAM,IAAA,sIAAY;IAElB,6DAA6D;IAC7D,MAAM,UAAU,MAAM,6HAAG,CAAC;;;;;;;;;;;;EAY1B,CAAC;IAED,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAK,WAAU;kCAA6G;;;;;;kCAG7H,8OAAC;wBAAG,WAAU;kCAAsE;;;;;;kCAGpF,8OAAC;wBAAE,WAAU;;4BAA8B,QAAQ,MAAM;4BAAC;4BAAqB,QAAQ,MAAM,KAAK,IAAI,MAAM;;;;;;;;;;;;;0BAG9G,8OAAC;gBAAI,WAAU;;oBACZ,QAAQ,MAAM,KAAK,mBAClB,8OAAC;wBAAE,WAAU;kCAA0C;;;;;;kCAEzD,8OAAC;wBAAI,WAAU;kCACZ,QAAQ,GAAG,CAAC,CAAC,kBACZ,8OAAC,0LAAI;gCAAY,MAAM,CAAC,eAAe,EAAE,EAAE,EAAE,EAAE;gCAC7C,WAAU;;kDACV,8OAAC;wCAAI,WAAU;;0DACb,8OAAC;gDAAI,WAAU;;kEACb,8OAAC;wDAAI,WAAU;kEACZ,EAAE,IAAI,CAAC,EAAE,CAAC,WAAW;;;;;;oDAEvB,SAAS,EAAE,YAAY,IAAI,mBAC1B,8OAAC;wDAAK,WAAU;kEACb,EAAE,YAAY;;;;;;;;;;;;0DAIrB,8OAAC;gDAAI,WAAU;;kEACb,8OAAC;wDAAE,WAAU;kEAAuC,EAAE,IAAI;;;;;;oDACzD,EAAE,SAAS,kBACV,8OAAC;wDAAE,WAAU;kEAAsC,EAAE,SAAS;;;;;;;;;;;;;;;;;;kDAIpE,8OAAC;wCAAI,WAAU;kDACZ,EAAE,eAAe,kBAChB,8OAAC;4CAAE,WAAU;sDACV,IAAI,KAAK,EAAE,eAAe,EAAE,kBAAkB,CAAC,SAAS;gDAAE,KAAK;gDAAW,OAAO;4CAAQ;;;;;;;;;;;;+BAvBvF,EAAE,EAAE;;;;;;;;;;;;;;;;;;;;;;AAiC3B"}}]
}