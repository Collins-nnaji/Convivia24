{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///Users/collinsnnaji/VSCodeDevelopments/convivia24/app/dashboard/pipeline/page.tsx"],"sourcesContent":["import { requireAuth, getAppUser } from '@/lib/auth/session';\nimport sql from '@/lib/db';\n\nconst STAGES = [\n  { key: 'lead',         label: 'Lead',         color: 'border-zinc-600' },\n  { key: 'qualified',    label: 'Qualified',    color: 'border-blue-600' },\n  { key: 'proposal',     label: 'Proposal',     color: 'border-yellow-500' },\n  { key: 'negotiation',  label: 'Negotiation',  color: 'border-orange-500' },\n  { key: 'closed_won',   label: 'Won',          color: 'border-green-600' },\n  { key: 'closed_lost',  label: 'Lost',         color: 'border-zinc-700' },\n];\n\nconst STAGE_DOT: Record<string, string> = {\n  lead: 'bg-zinc-500',\n  qualified: 'bg-blue-500',\n  proposal: 'bg-yellow-500',\n  negotiation: 'bg-orange-500',\n  closed_won: 'bg-green-500',\n  closed_lost: 'bg-zinc-600',\n};\n\nexport default async function PipelinePage() {\n  const authUser = await requireAuth();\n  const appUser = await getAppUser({ id: authUser.id, email: authUser.email!, name: authUser.name, image: authUser.image });\n\n  const clientRows = await sql`\n    SELECT c.* FROM clients c\n    JOIN client_users cu ON cu.client_id = c.id\n    WHERE cu.user_id = ${appUser.id}\n    LIMIT 1\n  `;\n  const client = clientRows[0] ?? null;\n\n  const deals = client\n    ? await sql`SELECT * FROM pipeline_deals WHERE client_id = ${client.id} ORDER BY created_at DESC`\n    : [];\n\n  const byStage = STAGES.reduce((acc: Record<string, any[]>, s) => {\n    acc[s.key] = deals.filter((d: any) => d.stage === s.key);\n    return acc;\n  }, {});\n\n  return (\n    <div className=\"p-8\">\n      <div className=\"mb-8\">\n        <span className=\"inline-block bg-red-700 text-white text-[9px] font-black uppercase tracking-[0.2em] px-2 py-1 mb-3\">\n          Pipeline\n        </span>\n        <h1 className=\"text-3xl font-black tracking-tighter text-white uppercase italic\">\n          Your Deals\n        </h1>\n        <p className=\"text-zinc-500 text-sm mt-1\">\n          {deals.length} deal{deals.length !== 1 ? 's' : ''} across {STAGES.length} stages\n        </p>\n      </div>\n\n      {!client ? (\n        <div className=\"bg-zinc-900 border border-zinc-800 p-6\">\n          <p className=\"text-zinc-400 text-sm\">No pipeline linked yet. Contact your account manager.</p>\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4\">\n          {STAGES.map(({ key, label, color }) => (\n            <div key={key} className={`bg-zinc-900 border-t-2 ${color} border-x border-b border-zinc-800`}>\n              <div className=\"px-4 py-3 border-b border-zinc-800 flex items-center justify-between\">\n                <div className=\"flex items-center gap-2\">\n                  <span className={`w-2 h-2 rounded-full ${STAGE_DOT[key]}`} />\n                  <span className=\"text-xs font-black uppercase tracking-[0.15em] text-zinc-300\">{label}</span>\n                </div>\n                <span className=\"text-xs text-zinc-600\">{byStage[key].length}</span>\n              </div>\n              <div className=\"p-3 space-y-2 min-h-[120px]\">\n                {byStage[key].length === 0 && (\n                  <p className=\"text-[11px] text-zinc-700 text-center pt-4\">No deals</p>\n                )}\n                {byStage[key].map((deal: any) => (\n                  <div key={deal.id} className=\"bg-zinc-800 border border-zinc-700 px-3 py-2.5\">\n                    <p className=\"text-sm font-semibold text-white leading-tight\">{deal.title}</p>\n                    {deal.value && (\n                      <p className=\"text-xs text-zinc-400 mt-1\">\n                        {deal.currency} {parseFloat(deal.value).toLocaleString()}\n                      </p>\n                    )}\n                    {deal.notes && (\n                      <p className=\"text-[11px] text-zinc-600 mt-1 line-clamp-2\">{deal.notes}</p>\n                    )}\n                    {deal.due_date && (\n                      <p className=\"text-[10px] text-zinc-600 mt-1\">\n                        Due {new Date(deal.due_date).toLocaleDateString('en-GB', { day: 'numeric', month: 'short' })}\n                      </p>\n                    )}\n                  </div>\n                ))}\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}