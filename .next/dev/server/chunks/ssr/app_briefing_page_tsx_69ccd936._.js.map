{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/collinsnnaji/VSCodeDevelopments/convivia24/app/briefing/page.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useRef, useEffect } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Send, Bot, User, Loader2 } from 'lucide-react';\n\ntype Message = { role: 'user' | 'assistant'; content: string };\n\nconst INITIAL_MESSAGE: Message = {\n  role: 'assistant',\n  content: \"Hi — I'm your AI Revenue Advisor. Ask me about pipeline health, sales audits, or how we can help. What's on your mind?\",\n};\n\nexport default function BriefingPage() {\n  const [messages, setMessages] = useState<Message[]>([INITIAL_MESSAGE]);\n  const [input, setInput] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [inquiryId, setInquiryId] = useState<string | null>(null);\n  const [streamingContent, setStreamingContent] = useState('');\n  const listRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    listRef.current?.scrollTo({ top: listRef.current.scrollHeight, behavior: 'smooth' });\n  }, [messages, streamingContent]);\n\n  async function handleSubmit(e: React.FormEvent) {\n    e.preventDefault();\n    const text = input.trim();\n    if (!text || loading) return;\n\n    const userMessage: Message = { role: 'user', content: text };\n    setMessages((prev) => [...prev, userMessage]);\n    setInput('');\n    setLoading(true);\n    setStreamingContent('');\n\n    try {\n      const res = await fetch('/api/chat', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          messages: [...messages, userMessage].map((m) => ({ role: m.role, content: m.content })),\n          inquiryId: inquiryId ?? undefined,\n        }),\n      });\n\n      if (!res.ok) {\n        const err = await res.json().catch(() => ({}));\n        throw new Error(err.error || `Request failed: ${res.status}`);\n      }\n\n      const reader = res.body?.getReader();\n      const decoder = new TextDecoder();\n      let buffer = '';\n      let streamedText = '';\n      const DATA_MARKER = '\\x00DATA:';\n\n      if (reader) {\n        while (true) {\n          const { done, value } = await reader.read();\n          if (done) break;\n          buffer += decoder.decode(value, { stream: true });\n          const idx = buffer.indexOf(DATA_MARKER);\n          if (idx !== -1) {\n            streamedText += buffer.slice(0, idx);\n            const jsonStr = buffer.slice(idx + DATA_MARKER.length).trim();\n            try {\n              const data = JSON.parse(jsonStr);\n              if (data.inquiryId) setInquiryId(data.inquiryId);\n            } catch {\n              // ignore\n            }\n            buffer = '';\n            break;\n          }\n          streamedText += buffer;\n          buffer = '';\n          setStreamingContent(streamedText);\n        }\n        if (buffer) {\n          const idx = buffer.indexOf(DATA_MARKER);\n          if (idx !== -1) {\n            streamedText += buffer.slice(0, idx);\n            try {\n              const data = JSON.parse(buffer.slice(idx + DATA_MARKER.length).trim());\n              if (data.inquiryId) setInquiryId(data.inquiryId);\n            } catch {\n              // ignore\n            }\n          } else {\n            streamedText += buffer;\n          }\n          setStreamingContent(streamedText);\n        }\n      }\n\n      const finalText = streamedText.trim();\n      if (finalText) setMessages((prev) => [...prev, { role: 'assistant', content: finalText }]);\n      setStreamingContent('');\n    } catch (err) {\n      setMessages((prev) => [\n        ...prev,\n        { role: 'assistant', content: `Sorry, something went wrong. ${err instanceof Error ? err.message : 'Please try again.'}` },\n      ]);\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  const displayMessages = streamingContent\n    ? [...messages, { role: 'assistant' as const, content: streamingContent }]\n    : messages;\n\n  return (\n    <div className=\"min-h-screen bg-white overflow-x-hidden\">\n      <section className=\"pt-28 pb-6 px-4 md:px-6 border-b border-zinc-100\">\n        <div className=\"max-w-2xl mx-auto\">\n          <motion.p\n            initial={{ opacity: 0, y: 8 }}\n            animate={{ opacity: 1, y: 0 }}\n            className=\"text-[10px] font-semibold uppercase tracking-widest text-red-700 mb-2\"\n          >\n            Live chat\n          </motion.p>\n          <motion.h1\n            initial={{ opacity: 0, y: 8 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ delay: 0.05 }}\n            className=\"text-3xl md:text-4xl font-black tracking-tight text-zinc-900\"\n          >\n            AI Revenue Advisor\n          </motion.h1>\n          <motion.p\n            initial={{ opacity: 0, y: 8 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ delay: 0.1 }}\n            className=\"text-sm text-zinc-500 mt-1\"\n          >\n            Chat with our AI agent. Your conversation is saved so we can follow up.\n          </motion.p>\n        </div>\n      </section>\n\n      <section className=\"max-w-2xl mx-auto px-4 md:px-6 py-6\">\n        <div\n          ref={listRef}\n          className=\"min-h-[320px] max-h-[55vh] overflow-y-auto space-y-4 pb-4\"\n        >\n          <AnimatePresence initial={false}>\n            {displayMessages.map((msg, i) => (\n              <motion.div\n                key={i}\n                initial={{ opacity: 0, y: 8 }}\n                animate={{ opacity: 1, y: 0 }}\n                className={`flex gap-3 ${msg.role === 'user' ? 'flex-row-reverse' : ''}`}\n              >\n                <div\n                  className={`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${\n                    msg.role === 'user' ? 'bg-zinc-800 text-white' : 'bg-red-700 text-white'\n                  }`}\n                >\n                  {msg.role === 'user' ? <User size={16} /> : <Bot size={16} />}\n                </div>\n                <div\n                  className={`max-w-[85%] rounded-lg px-4 py-3 text-sm ${\n                    msg.role === 'user'\n                      ? 'bg-zinc-900 text-white'\n                      : 'bg-zinc-100 text-zinc-900 border border-zinc-200'\n                  }`}\n                >\n                  <p className=\"whitespace-pre-wrap break-words\">{msg.content}</p>\n                  {msg.role === 'assistant' && i === displayMessages.length - 1 && loading && (\n                    <span className=\"inline-block w-2 h-4 ml-0.5 bg-red-600 animate-pulse\" />\n                  )}\n                </div>\n              </motion.div>\n            ))}\n          </AnimatePresence>\n        </div>\n\n        <form onSubmit={handleSubmit} className=\"flex gap-2 mt-4\">\n          <input\n            type=\"text\"\n            value={input}\n            onChange={(e) => setInput(e.target.value)}\n            placeholder=\"Type your message...\"\n            className=\"flex-1 px-4 py-3 border border-zinc-300 rounded-lg text-zinc-900 placeholder-zinc-400 focus:outline-none focus:ring-2 focus:ring-red-600 focus:border-transparent\"\n            disabled={loading}\n          />\n          <button\n            type=\"submit\"\n            disabled={loading || !input.trim()}\n            className=\"px-4 py-3 bg-red-700 text-white rounded-lg font-semibold hover:bg-red-800 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\n          >\n            {loading ? <Loader2 size={18} className=\"animate-spin\" /> : <Send size={18} />}\n            Send\n          </button>\n        </form>\n\n        {inquiryId && (\n          <p className=\"text-[10px] uppercase tracking-widest text-zinc-400 mt-3\">\n            Conversation saved. We’ll follow up if you shared your details.\n          </p>\n        )}\n      </section>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}