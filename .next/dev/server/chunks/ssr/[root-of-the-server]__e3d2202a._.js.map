{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///Users/collinsnnaji/VSCodeDevelopments/convivia24/app/admin/pipeline/page.tsx"],"sourcesContent":["import { requireAdmin } from '@/lib/auth/session';\nimport sql from '@/lib/db';\nimport Link from 'next/link';\n\nconst STAGES = [\n  { key: 'lead',         label: 'Lead',         color: 'border-zinc-600' },\n  { key: 'qualified',    label: 'Qualified',    color: 'border-blue-600' },\n  { key: 'proposal',     label: 'Proposal',     color: 'border-yellow-500' },\n  { key: 'negotiation',  label: 'Negotiation',  color: 'border-orange-500' },\n  { key: 'closed_won',   label: 'Won',          color: 'border-green-600' },\n  { key: 'closed_lost',  label: 'Lost',         color: 'border-zinc-700' },\n];\n\nexport default async function AdminPipelinePage() {\n  await requireAdmin();\n\n  const deals = await sql`\n    SELECT d.*, c.name as client_name\n    FROM pipeline_deals d\n    JOIN clients c ON c.id = d.client_id\n    ORDER BY d.updated_at DESC\n  `;\n\n  const byStage = STAGES.reduce((acc: Record<string, any[]>, s) => {\n    acc[s.key] = deals.filter((d: any) => d.stage === s.key);\n    return acc;\n  }, {});\n\n  const totalOpen = deals.filter((d: any) => !['closed_won','closed_lost'].includes(d.stage));\n  const totalValue = totalOpen.reduce((sum: number, d: any) => sum + parseFloat(d.value || 0), 0);\n\n  return (\n    <div className=\"p-8\">\n      <div className=\"mb-8\">\n        <span className=\"inline-block bg-red-600 text-white text-[9px] font-black uppercase tracking-[0.2em] px-2 py-1 mb-3 rounded\">\n          Pipeline\n        </span>\n        <h1 className=\"text-3xl font-black tracking-tighter text-zinc-900 uppercase italic\">\n          All Deals\n        </h1>\n        <p className=\"text-zinc-600 text-sm mt-1\">\n          {totalOpen.length} open deals · £{(totalValue / 1000).toFixed(0)}k pipeline value\n        </p>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4\">\n        {STAGES.map(({ key, label, color }) => (\n          <div key={key} className={`bg-white border-t-2 ${color} border-x border-b border-zinc-200 shadow-sm rounded-lg overflow-hidden`}>\n            <div className=\"px-4 py-3 border-b border-zinc-200 flex items-center justify-between\">\n              <span className=\"text-xs font-black uppercase tracking-[0.15em] text-zinc-700\">{label}</span>\n              <span className=\"text-xs text-zinc-500\">{byStage[key].length}</span>\n            </div>\n            <div className=\"p-3 space-y-2 min-h-[100px]\">\n              {byStage[key].length === 0 && (\n                <p className=\"text-[11px] text-zinc-500 text-center pt-3\">Empty</p>\n              )}\n              {byStage[key].map((deal: any) => (\n                <Link key={deal.id} href={`/admin/clients/${deal.client_id}`}\n                  className=\"block bg-zinc-50 border border-zinc-200 hover:bg-zinc-100 hover:border-zinc-300 px-3 py-2.5 rounded transition-colors\">\n                  <p className=\"text-sm font-semibold text-zinc-900 leading-tight\">{deal.title}</p>\n                  <p className=\"text-[11px] text-zinc-500 mt-0.5\">{deal.client_name}</p>\n                  {deal.value && (\n                    <p className=\"text-[11px] text-zinc-600 mt-1\">£{parseFloat(deal.value).toLocaleString()}</p>\n                  )}\n                </Link>\n              ))}\n            </div>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;;;;;AAEA,MAAM,SAAS;IACb;QAAE,KAAK;QAAgB,OAAO;QAAgB,OAAO;IAAkB;IACvE;QAAE,KAAK;QAAgB,OAAO;QAAgB,OAAO;IAAkB;IACvE;QAAE,KAAK;QAAgB,OAAO;QAAgB,OAAO;IAAoB;IACzE;QAAE,KAAK;QAAgB,OAAO;QAAgB,OAAO;IAAoB;IACzE;QAAE,KAAK;QAAgB,OAAO;QAAgB,OAAO;IAAmB;IACxE;QAAE,KAAK;QAAgB,OAAO;QAAgB,OAAO;IAAkB;CACxE;AAEc,eAAe;IAC5B,MAAM,IAAA,sIAAY;IAElB,MAAM,QAAQ,MAAM,6HAAG,CAAC;;;;;EAKxB,CAAC;IAED,MAAM,UAAU,OAAO,MAAM,CAAC,CAAC,KAA4B;QACzD,GAAG,CAAC,EAAE,GAAG,CAAC,GAAG,MAAM,MAAM,CAAC,CAAC,IAAW,EAAE,KAAK,KAAK,EAAE,GAAG;QACvD,OAAO;IACT,GAAG,CAAC;IAEJ,MAAM,YAAY,MAAM,MAAM,CAAC,CAAC,IAAW,CAAC;YAAC;YAAa;SAAc,CAAC,QAAQ,CAAC,EAAE,KAAK;IACzF,MAAM,aAAa,UAAU,MAAM,CAAC,CAAC,KAAa,IAAW,MAAM,WAAW,EAAE,KAAK,IAAI,IAAI;IAE7F,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAK,WAAU;kCAA6G;;;;;;kCAG7H,8OAAC;wBAAG,WAAU;kCAAsE;;;;;;kCAGpF,8OAAC;wBAAE,WAAU;;4BACV,UAAU,MAAM;4BAAC;4BAAgB,CAAC,aAAa,IAAI,EAAE,OAAO,CAAC;4BAAG;;;;;;;;;;;;;0BAIrE,8OAAC;gBAAI,WAAU;0BACZ,OAAO,GAAG,CAAC,CAAC,EAAE,GAAG,EAAE,KAAK,EAAE,KAAK,EAAE,iBAChC,8OAAC;wBAAc,WAAW,CAAC,oBAAoB,EAAE,MAAM,uEAAuE,CAAC;;0CAC7H,8OAAC;gCAAI,WAAU;;kDACb,8OAAC;wCAAK,WAAU;kDAAgE;;;;;;kDAChF,8OAAC;wCAAK,WAAU;kDAAyB,OAAO,CAAC,IAAI,CAAC,MAAM;;;;;;;;;;;;0CAE9D,8OAAC;gCAAI,WAAU;;oCACZ,OAAO,CAAC,IAAI,CAAC,MAAM,KAAK,mBACvB,8OAAC;wCAAE,WAAU;kDAA6C;;;;;;oCAE3D,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,qBACjB,8OAAC,0LAAI;4CAAe,MAAM,CAAC,eAAe,EAAE,KAAK,SAAS,EAAE;4CAC1D,WAAU;;8DACV,8OAAC;oDAAE,WAAU;8DAAqD,KAAK,KAAK;;;;;;8DAC5E,8OAAC;oDAAE,WAAU;8DAAoC,KAAK,WAAW;;;;;;gDAChE,KAAK,KAAK,kBACT,8OAAC;oDAAE,WAAU;;wDAAiC;wDAAE,WAAW,KAAK,KAAK,EAAE,cAAc;;;;;;;;2CAL9E,KAAK,EAAE;;;;;;;;;;;;uBAVd;;;;;;;;;;;;;;;;AAyBpB"}}]
}