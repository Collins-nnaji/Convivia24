{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///Users/collinsnnaji/VSCodeDevelopments/convivia24/app/admin/page.tsx"],"sourcesContent":["import { requireAdmin } from '@/lib/auth/session';\nimport sql from '@/lib/db';\nimport Link from 'next/link';\nimport { Users, GitBranch, MessageSquare, ClipboardList, Package, ArrowRight } from 'lucide-react';\n\nexport default async function AdminOverview() {\n  await requireAdmin();\n\n  const [\n    clientCount,\n    dealCount,\n    unreadCount,\n    leadCount,\n    listingCount,\n    listingSubmittedCount,\n    recentDeals,\n    recentLeads,\n    recentListings,\n  ] = await Promise.all([\n    sql`SELECT COUNT(*) as count FROM clients WHERE status = 'active'`,\n    sql`SELECT COUNT(*) as count FROM pipeline_deals WHERE stage NOT IN ('closed_won','closed_lost')`,\n    sql`SELECT COUNT(*) as count FROM messages WHERE sender_role = 'client' AND read_at IS NULL`,\n    sql`SELECT COUNT(*) as count FROM audit_leads WHERE status = 'new'`,\n    sql`SELECT COUNT(*) as count FROM listings`,\n    sql`SELECT COUNT(*) as count FROM listings WHERE status IN ('submitted','price_agreed','listed')`,\n    sql`SELECT d.*, c.name as client_name FROM pipeline_deals d JOIN clients c ON c.id = d.client_id ORDER BY d.updated_at DESC LIMIT 6`,\n    sql`SELECT * FROM audit_leads WHERE status = 'new' ORDER BY created_at DESC LIMIT 5`,\n    sql`SELECT l.id, l.title, l.status, l.client_id, c.name as client_name FROM listings l JOIN clients c ON c.id = l.client_id WHERE l.status IN ('submitted','price_agreed','listed') ORDER BY l.updated_at DESC LIMIT 5`,\n  ]);\n\n  const stats = [\n    { label: 'Active Clients',    value: Number(clientCount[0]?.count ?? 0),  icon: Users,         href: '/admin/clients' },\n    { label: 'Open Deals',        value: Number(dealCount[0]?.count ?? 0),    icon: GitBranch,     href: '/admin/pipeline' },\n    { label: 'Listings',          value: Number(listingCount[0]?.count ?? 0),  icon: Package,      href: '/admin/listings', sub: Number(listingSubmittedCount[0]?.count ?? 0) > 0 ? `${listingSubmittedCount[0]?.count} in progress` : undefined },\n    { label: 'Unread Messages',   value: Number(unreadCount[0]?.count ?? 0),  icon: MessageSquare, href: '/admin/messages' },\n    { label: 'New Leads',         value: Number(leadCount[0]?.count ?? 0),    icon: ClipboardList, href: '/admin/leads' },\n  ];\n\n  const STAGE_COLORS: Record<string, string> = {\n    lead: 'bg-zinc-700', qualified: 'bg-blue-700', proposal: 'bg-yellow-600',\n    negotiation: 'bg-orange-600', closed_won: 'bg-green-700', closed_lost: 'bg-zinc-600',\n  };\n\n  return (\n    <div className=\"p-8 max-w-6xl\">\n      <div className=\"mb-8\">\n        <span className=\"inline-block bg-red-600 text-white text-[9px] font-black uppercase tracking-[0.2em] px-2 py-1 mb-3\">\n          Command Center\n        </span>\n        <h1 className=\"text-3xl font-black tracking-tighter text-zinc-900 uppercase italic\">\n          Admin Overview\n        </h1>\n        <p className=\"text-zinc-600 text-sm mt-1\">Everything across all client accounts</p>\n      </div>\n\n      {/* Stats */}\n      <div className=\"grid grid-cols-2 lg:grid-cols-5 gap-4 mb-8\">\n        {stats.map(({ label, value, sub, icon: Icon, href }) => (\n          <Link key={label} href={href}\n            className=\"group bg-white border border-zinc-200 hover:border-red-400 shadow-sm p-5 transition-colors rounded-lg\"\n          >\n            <Icon size={16} className=\"text-red-600 mb-3 group-hover:text-red-500\" />\n            <p className=\"text-2xl font-black text-zinc-900 tracking-tighter\">{value}</p>\n            <p className=\"text-[11px] text-zinc-500 uppercase tracking-[0.15em] mt-1\">{label}</p>\n            {sub !== undefined && sub !== null && <p className=\"text-[10px] text-zinc-500 mt-0.5\">{sub}</p>}\n          </Link>\n        ))}\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        {/* Recent deals */}\n        <div className=\"bg-white border border-zinc-200 shadow-sm rounded-lg overflow-hidden\">\n          <div className=\"flex items-center justify-between px-6 py-4 border-b border-zinc-200\">\n            <h2 className=\"text-sm font-black uppercase tracking-[0.15em] text-zinc-900\">Recent Deals</h2>\n            <Link href=\"/admin/pipeline\" className=\"text-[11px] text-red-600 hover:text-red-500 flex items-center gap-1\">\n              All <ArrowRight size={11} />\n            </Link>\n          </div>\n          <div className=\"divide-y divide-zinc-100\">\n            {recentDeals.map((d: any) => (\n              <div key={d.id} className=\"flex items-center justify-between px-6 py-3\">\n                <div className=\"flex items-center gap-2 min-w-0\">\n                  <span className={`shrink-0 text-[9px] font-black uppercase text-white px-1.5 py-0.5 rounded ${STAGE_COLORS[d.stage] || 'bg-zinc-600'}`}>\n                    {d.stage.replace('_', ' ')}\n                  </span>\n                  <div className=\"min-w-0\">\n                    <p className=\"text-sm text-zinc-800 truncate\">{d.title}</p>\n                    <p className=\"text-[11px] text-zinc-500 truncate\">{d.client_name}</p>\n                  </div>\n                </div>\n                {d.value && (\n                  <span className=\"text-sm font-semibold text-zinc-900 shrink-0 ml-2\">\n                    {(d.currency === 'GBP' ? 'Â£' : (d.currency || '') + ' ')}{parseFloat(d.value).toLocaleString()}\n                  </span>\n                )}\n              </div>\n            ))}\n          </div>\n        </div>\n\n        {/* New leads */}\n        <div className=\"bg-white border border-zinc-200 shadow-sm rounded-lg overflow-hidden\">\n          <div className=\"flex items-center justify-between px-6 py-4 border-b border-zinc-200\">\n            <h2 className=\"text-sm font-black uppercase tracking-[0.15em] text-zinc-900\">New Audit Leads</h2>\n            <Link href=\"/admin/leads\" className=\"text-[11px] text-red-600 hover:text-red-500 flex items-center gap-1\">\n              All <ArrowRight size={11} />\n            </Link>\n          </div>\n          <div className=\"divide-y divide-zinc-100\">\n            {recentLeads.length === 0 && (\n              <p className=\"text-zinc-500 text-sm text-center py-6\">No new leads</p>\n            )}\n            {recentLeads.map((lead: any) => (\n              <div key={lead.id} className=\"px-6 py-3\">\n                <p className=\"text-sm font-semibold text-zinc-900\">{lead.company || 'Unknown Company'}</p>\n                <p className=\"text-[11px] text-zinc-500\">{lead.email}</p>\n                <p className=\"text-[10px] text-zinc-500 mt-0.5\">\n                  {new Date(lead.created_at).toLocaleDateString('en-GB')}\n                </p>\n              </div>\n            ))}\n          </div>\n        </div>\n\n        {/* Recent listings (in progress) */}\n        <div className=\"bg-white border border-zinc-200 shadow-sm rounded-lg overflow-hidden\">\n          <div className=\"flex items-center justify-between px-6 py-4 border-b border-zinc-200\">\n            <h2 className=\"text-sm font-black uppercase tracking-[0.15em] text-zinc-900\">Listings in progress</h2>\n            <Link href=\"/admin/listings\" className=\"text-[11px] text-red-600 hover:text-red-500 flex items-center gap-1\">\n              All <ArrowRight size={11} />\n            </Link>\n          </div>\n          <div className=\"divide-y divide-zinc-100\">\n            {(recentListings as { id: string; title: string; status: string; client_name: string }[]).length === 0 ? (\n              <p className=\"text-zinc-500 text-sm text-center py-6\">No listings in progress</p>\n            ) : (\n              (recentListings as { id: string; title: string; status: string; client_name: string }[]).map((l) => (\n                <Link key={l.id} href={`/admin/listings/${l.id}`} className=\"flex items-center justify-between px-6 py-3 hover:bg-zinc-50 transition-colors\">\n                  <div className=\"min-w-0\">\n                    <p className=\"text-sm text-zinc-800 truncate\">{l.title}</p>\n                    <p className=\"text-[11px] text-zinc-500 truncate\">{l.client_name}</p>\n                  </div>\n                  <span className=\"text-[10px] font-black uppercase px-2 py-0.5 rounded bg-zinc-200 text-zinc-700 shrink-0 ml-2\">\n                    {l.status.replace('_', ' ')}\n                  </span>\n                </Link>\n              ))\n            )}\n          </div>\n        </div>\n      </div>\n\n      {/* Quick links */}\n      <div className=\"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-6 gap-3 mt-8\">\n        {[\n          { href: '/admin/clients',   label: 'Clients' },\n          { href: '/admin/clients/new', label: 'New client' },\n          { href: '/admin/listings',  label: 'Listings' },\n          { href: '/admin/pipeline',  label: 'Pipeline' },\n          { href: '/admin/messages',  label: 'Messages' },\n          { href: '/admin/leads',     label: 'Leads' },\n        ].map(({ href, label }) => (\n          <Link\n            key={href}\n            href={href}\n            className=\"flex items-center justify-between bg-white border border-zinc-200 hover:border-red-400 px-4 py-3 transition-colors rounded-lg shadow-sm\"\n          >\n            <span className=\"text-sm font-semibold text-zinc-800\">{label}</span>\n            <ArrowRight size={12} className=\"text-zinc-400\" />\n          </Link>\n        ))}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}