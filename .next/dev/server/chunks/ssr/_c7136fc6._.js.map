{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/collinsnnaji/VSCodeDevelopments/convivia24/lib/auth/server.ts"],"sourcesContent":["import { createNeonAuth } from '@neondatabase/auth/next/server';\n\nexport function getAuth() {\n  return createNeonAuth({\n    baseUrl: process.env.NEON_AUTH_BASE_URL!,\n    cookies: {\n      secret: process.env.NEON_AUTH_COOKIE_SECRET!,\n    },\n  });\n}\n\n// Normalize Neon's { data, error } so session?.user works everywhere (dashboard, API routes)\nasync function getSessionNormalized() {\n  const { data } = await getAuth().getSession();\n  const user = data?.user ?? (data as any)?.session?.user;\n  if (!user) return null;\n  return { ...data, user } as { user: { id: string; email?: string | null; name?: string | null; image?: string | null }; [k: string]: unknown };\n}\n\n// Convenience alias â€” call getAuth() in request handlers, not at module level\nexport const auth = {\n  getSession: getSessionNormalized,\n  handler: () => getAuth().handler(),\n  middleware: (config?: { loginUrl?: string }) => getAuth().middleware(config),\n};\n"],"names":[],"mappings":";;;;;;AAAA;;AAEO,SAAS;IACd,OAAO,IAAA,4LAAc,EAAC;QACpB,SAAS,QAAQ,GAAG,CAAC,kBAAkB;QACvC,SAAS;YACP,QAAQ,QAAQ,GAAG,CAAC,uBAAuB;QAC7C;IACF;AACF;AAEA,6FAA6F;AAC7F,eAAe;IACb,MAAM,EAAE,IAAI,EAAE,GAAG,MAAM,UAAU,UAAU;IAC3C,MAAM,OAAO,MAAM,QAAS,MAAc,SAAS;IACnD,IAAI,CAAC,MAAM,OAAO;IAClB,OAAO;QAAE,GAAG,IAAI;QAAE;IAAK;AACzB;AAGO,MAAM,OAAO;IAClB,YAAY;IACZ,SAAS,IAAM,UAAU,OAAO;IAChC,YAAY,CAAC,SAAmC,UAAU,UAAU,CAAC;AACvE"}},
    {"offset": {"line": 39, "column": 0}, "map": {"version":3,"sources":["file:///Users/collinsnnaji/VSCodeDevelopments/convivia24/lib/db/index.ts"],"sourcesContent":["import { neon, type NeonQueryFunction } from '@neondatabase/serverless';\n\nlet _sql: NeonQueryFunction<false, false> | null = null;\n\nfunction getSql() {\n  if (!_sql) _sql = neon(process.env.DATABASE_URL!);\n  return _sql;\n}\n\n// Export a real function so Turbopack/bundler treats it as callable (Proxy can break in server bundle)\nfunction sql(strings: TemplateStringsArray, ...values: unknown[]) {\n  return (getSql() as (...args: unknown[]) => unknown)(strings, ...values);\n}\n\nexport default sql;\n"],"names":[],"mappings":";;;;AAAA;;AAEA,IAAI,OAA+C;AAEnD,SAAS;IACP,IAAI,CAAC,MAAM,OAAO,IAAA,8JAAI,EAAC,QAAQ,GAAG,CAAC,YAAY;IAC/C,OAAO;AACT;AAEA,uGAAuG;AACvG,SAAS,IAAI,OAA6B,EAAE,GAAG,MAAiB;IAC9D,OAAO,AAAC,SAA6C,YAAY;AACnE;uCAEe"}},
    {"offset": {"line": 59, "column": 0}, "map": {"version":3,"sources":["file:///Users/collinsnnaji/VSCodeDevelopments/convivia24/lib/auth/session.ts"],"sourcesContent":["import { auth } from './server';\nimport sql from '@/lib/db';\nimport { redirect } from 'next/navigation';\n\n/** Only these emails get admin role on login. Single source of truth for \"who can be admin\". */\nexport const ADMIN_EMAILS = ['collinsnnaji1@gmail.com', 'speak2tojo@gmail.com'] as const;\n\nconst ADMIN_EMAILS_LOWER = ADMIN_EMAILS.map((e) => e.toLowerCase());\n\nexport function isAdmin(email: string | null | undefined): boolean {\n  return !!email && ADMIN_EMAILS_LOWER.includes(email.toLowerCase().trim());\n}\n\nexport async function getSession() {\n  return auth.getSession();\n}\n\nexport async function requireAuth() {\n  const session = await auth.getSession();\n  if (!session?.user) redirect('/auth/sign-in');\n  return session.user;\n}\n\n/** Use app_users.role (synced from ADMIN_EMAILS on login) so DB is source of truth for access */\nexport async function requireAdmin() {\n  const user = await requireAuth();\n  const appUser = await getAppUser({ id: user.id, email: user.email!, name: user.name, image: user.image });\n  if (appUser.role !== 'admin') redirect('/dashboard');\n  return user;\n}\n\n/** Upsert Neon Auth user into app_users; role is kept in sync with ADMIN_EMAILS on every login */\nexport async function syncUser(authUser: { id: string; email: string; name?: string | null; image?: string | null }) {\n  const role = isAdmin(authUser.email) ? 'admin' : 'client';\n  const rows = await sql`\n    INSERT INTO app_users (id, email, name, image, role)\n    VALUES (${authUser.id}, ${authUser.email}, ${authUser.name ?? null}, ${authUser.image ?? null}, ${role})\n    ON CONFLICT (email) DO UPDATE\n      SET name  = EXCLUDED.name,\n          image = EXCLUDED.image,\n          id    = EXCLUDED.id,\n          role  = EXCLUDED.role\n    RETURNING *\n  `;\n  return rows[0];\n}\n\n/** Get app_user row, syncing from auth if needed */\nexport async function getAppUser(authUser: { id: string; email: string; name?: string | null; image?: string | null }) {\n  const rows = await sql`SELECT * FROM app_users WHERE email = ${authUser.email}`;\n  if (rows.length) return rows[0];\n  return syncUser(authUser);\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;AACA;AACA;AAAA;;;;AAGO,MAAM,eAAe;IAAC;IAA2B;CAAuB;AAE/E,MAAM,qBAAqB,aAAa,GAAG,CAAC,CAAC,IAAM,EAAE,WAAW;AAEzD,SAAS,QAAQ,KAAgC;IACtD,OAAO,CAAC,CAAC,SAAS,mBAAmB,QAAQ,CAAC,MAAM,WAAW,GAAG,IAAI;AACxE;AAEO,eAAe;IACpB,OAAO,6HAAI,CAAC,UAAU;AACxB;AAEO,eAAe;IACpB,MAAM,UAAU,MAAM,6HAAI,CAAC,UAAU;IACrC,IAAI,CAAC,SAAS,MAAM,IAAA,iMAAQ,EAAC;IAC7B,OAAO,QAAQ,IAAI;AACrB;AAGO,eAAe;IACpB,MAAM,OAAO,MAAM;IACnB,MAAM,UAAU,MAAM,WAAW;QAAE,IAAI,KAAK,EAAE;QAAE,OAAO,KAAK,KAAK;QAAG,MAAM,KAAK,IAAI;QAAE,OAAO,KAAK,KAAK;IAAC;IACvG,IAAI,QAAQ,IAAI,KAAK,SAAS,IAAA,iMAAQ,EAAC;IACvC,OAAO;AACT;AAGO,eAAe,SAAS,QAAoF;IACjH,MAAM,OAAO,QAAQ,SAAS,KAAK,IAAI,UAAU;IACjD,MAAM,OAAO,MAAM,6HAAG,CAAC;;YAEb,EAAE,SAAS,EAAE,CAAC,EAAE,EAAE,SAAS,KAAK,CAAC,EAAE,EAAE,SAAS,IAAI,IAAI,KAAK,EAAE,EAAE,SAAS,KAAK,IAAI,KAAK,EAAE,EAAE,KAAK;;;;;;;EAOzG,CAAC;IACD,OAAO,IAAI,CAAC,EAAE;AAChB;AAGO,eAAe,WAAW,QAAoF;IACnH,MAAM,OAAO,MAAM,6HAAG,CAAC,sCAAsC,EAAE,SAAS,KAAK,CAAC,CAAC;IAC/E,IAAI,KAAK,MAAM,EAAE,OAAO,IAAI,CAAC,EAAE;IAC/B,OAAO,SAAS;AAClB"}},
    {"offset": {"line": 132, "column": 0}, "map": {"version":3,"sources":["file:///Users/collinsnnaji/VSCodeDevelopments/convivia24/app/dashboard/layout.tsx"],"sourcesContent":["import { requireAuth, getAppUser } from '@/lib/auth/session';\nimport { canAccessAdmin } from '@/lib/auth/access';\nimport Link from 'next/link';\nimport { LayoutDashboard, GitBranch, MessageSquare, FileText, LogOut, ShieldCheck } from 'lucide-react';\n\nconst navItems = [\n  { href: '/dashboard',           label: 'Overview',  icon: LayoutDashboard },\n  { href: '/dashboard/pipeline',  label: 'Pipeline',  icon: GitBranch },\n  { href: '/dashboard/messages',  label: 'Messages',  icon: MessageSquare },\n  { href: '/dashboard/documents', label: 'Documents', icon: FileText },\n];\n\nexport default async function DashboardLayout({ children }: { children: React.ReactNode }) {\n  const authUser = await requireAuth();\n  const appUser = await getAppUser({\n    id: authUser.id,\n    email: authUser.email!,\n    name: authUser.name,\n    image: authUser.image,\n  });\n\n  return (\n    <div className=\"min-h-screen bg-zinc-950 flex\">\n      {/* Sidebar */}\n      <aside className=\"w-56 shrink-0 bg-zinc-900 border-r border-zinc-800 flex flex-col\">\n        {/* Brand */}\n        <div className=\"px-5 py-5 border-b border-zinc-800\">\n          <Link href=\"/\">\n            <img src=\"/convivia24.png\" alt=\"Convivia24\" className=\"h-6 w-auto\" style={{ filter: 'brightness(0) invert(1)' }} />\n          </Link>\n          <p className=\"text-[9px] font-black uppercase tracking-[0.2em] text-zinc-600 mt-2\">Pipeline Suite</p>\n        </div>\n\n        {/* Nav */}\n        <nav className=\"flex-1 px-3 py-4 space-y-0.5\">\n          {navItems.map(({ href, label, icon: Icon }) => (\n            <Link\n              key={href}\n              href={href}\n              className=\"flex items-center gap-2.5 px-3 py-2.5 text-sm font-semibold text-zinc-400 hover:text-white hover:bg-zinc-800 transition-colors rounded-sm group\"\n            >\n              <Icon size={15} className=\"shrink-0\" />\n              {label}\n            </Link>\n          ))}\n        </nav>\n\n        {/* User */}\n        <div className=\"px-3 py-4 border-t border-zinc-800\">\n          <div className=\"flex items-center gap-2.5 px-3 py-2 mb-1\">\n            {appUser.image ? (\n              <img src={appUser.image} alt=\"\" className=\"w-7 h-7 rounded-full object-cover\" />\n            ) : (\n              <div className=\"w-7 h-7 rounded-full bg-red-700 flex items-center justify-center text-white text-xs font-black\">\n                {(appUser.name || appUser.email || 'U')[0].toUpperCase()}\n              </div>\n            )}\n            <div className=\"min-w-0\">\n              <p className=\"text-xs font-semibold text-white truncate\">{appUser.name || 'Client'}</p>\n              <p className=\"text-[10px] text-zinc-500 truncate\">{appUser.email}</p>\n            </div>\n          </div>\n          {isAdmin(appUser.email) && (\n            <Link\n              href=\"/admin\"\n              className=\"flex items-center gap-2 px-3 py-2 text-xs text-red-600 hover:text-red-400 transition-colors\"\n            >\n              <ShieldCheck size={13} />\n              Admin panel\n            </Link>\n          )}\n          <Link\n            href=\"/api/auth/sign-out\"\n            className=\"flex items-center gap-2 px-3 py-2 text-xs text-zinc-500 hover:text-white transition-colors\"\n          >\n            <LogOut size={13} />\n            Sign out\n          </Link>\n        </div>\n      </aside>\n\n      {/* Main */}\n      <main className=\"flex-1 overflow-auto\">\n        {children}\n      </main>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;AAEA,MAAM,WAAW;IACf;QAAE,MAAM;QAAwB,OAAO;QAAa,MAAM,+OAAe;IAAC;IAC1E;QAAE,MAAM;QAAwB,OAAO;QAAa,MAAM,6NAAS;IAAC;IACpE;QAAE,MAAM;QAAwB,OAAO;QAAa,MAAM,yOAAa;IAAC;IACxE;QAAE,MAAM;QAAwB,OAAO;QAAa,MAAM,0NAAQ;IAAC;CACpE;AAEc,eAAe,gBAAgB,EAAE,QAAQ,EAAiC;IACvF,MAAM,WAAW,MAAM,IAAA,qIAAW;IAClC,MAAM,UAAU,MAAM,IAAA,oIAAU,EAAC;QAC/B,IAAI,SAAS,EAAE;QACf,OAAO,SAAS,KAAK;QACrB,MAAM,SAAS,IAAI;QACnB,OAAO,SAAS,KAAK;IACvB;IAEA,qBACE,8OAAC;QAAI,WAAU;;0BAEb,8OAAC;gBAAM,WAAU;;kCAEf,8OAAC;wBAAI,WAAU;;0CACb,8OAAC,0LAAI;gCAAC,MAAK;0CACT,cAAA,8OAAC;oCAAI,KAAI;oCAAkB,KAAI;oCAAa,WAAU;oCAAa,OAAO;wCAAE,QAAQ;oCAA0B;;;;;;;;;;;0CAEhH,8OAAC;gCAAE,WAAU;0CAAsE;;;;;;;;;;;;kCAIrF,8OAAC;wBAAI,WAAU;kCACZ,SAAS,GAAG,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,MAAM,IAAI,EAAE,iBACxC,8OAAC,0LAAI;gCAEH,MAAM;gCACN,WAAU;;kDAEV,8OAAC;wCAAK,MAAM;wCAAI,WAAU;;;;;;oCACzB;;+BALI;;;;;;;;;;kCAWX,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAI,WAAU;;oCACZ,QAAQ,KAAK,iBACZ,8OAAC;wCAAI,KAAK,QAAQ,KAAK;wCAAE,KAAI;wCAAG,WAAU;;;;;6DAE1C,8OAAC;wCAAI,WAAU;kDACZ,CAAC,QAAQ,IAAI,IAAI,QAAQ,KAAK,IAAI,GAAG,CAAC,CAAC,EAAE,CAAC,WAAW;;;;;;kDAG1D,8OAAC;wCAAI,WAAU;;0DACb,8OAAC;gDAAE,WAAU;0DAA6C,QAAQ,IAAI,IAAI;;;;;;0DAC1E,8OAAC;gDAAE,WAAU;0DAAsC,QAAQ,KAAK;;;;;;;;;;;;;;;;;;4BAGnE,QAAQ,QAAQ,KAAK,mBACpB,8OAAC,0LAAI;gCACH,MAAK;gCACL,WAAU;;kDAEV,8OAAC,mOAAW;wCAAC,MAAM;;;;;;oCAAM;;;;;;;0CAI7B,8OAAC,0LAAI;gCACH,MAAK;gCACL,WAAU;;kDAEV,8OAAC,oNAAM;wCAAC,MAAM;;;;;;oCAAM;;;;;;;;;;;;;;;;;;;0BAO1B,8OAAC;gBAAK,WAAU;0BACb;;;;;;;;;;;;AAIT"}}]
}