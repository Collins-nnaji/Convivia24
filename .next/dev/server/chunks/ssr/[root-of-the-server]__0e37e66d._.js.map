{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///Users/collinsnnaji/VSCodeDevelopments/convivia24/app/dashboard/page.tsx"],"sourcesContent":["import { requireAuth, getAppUser } from '@/lib/auth/session';\nimport sql from '@/lib/db';\nimport Link from 'next/link';\nimport { ArrowRight, GitBranch, MessageSquare, FileText, TrendingUp, ShieldAlert } from 'lucide-react';\n\nconst STAGE_LABELS: Record<string, string> = {\n  lead: 'Lead',\n  qualified: 'Qualified',\n  proposal: 'Proposal',\n  negotiation: 'Negotiation',\n  closed_won: 'Won',\n  closed_lost: 'Lost',\n};\n\nconst STAGE_COLORS: Record<string, string> = {\n  lead: 'bg-zinc-700',\n  qualified: 'bg-blue-700',\n  proposal: 'bg-yellow-600',\n  negotiation: 'bg-orange-600',\n  closed_won: 'bg-green-700',\n  closed_lost: 'bg-zinc-600',\n};\n\nexport default async function DashboardPage(props: { searchParams: Promise<{ admin?: string }> }) {\n  const searchParams = await props.searchParams;\n  const authUser = await requireAuth();\n  const appUser = await getAppUser({ id: authUser.id, email: authUser.email!, name: authUser.name, image: authUser.image });\n\n  // Get client linked to this user\n  const clientRows = await sql`\n    SELECT c.* FROM clients c\n    JOIN client_users cu ON cu.client_id = c.id\n    WHERE cu.user_id = ${appUser.id}\n    LIMIT 1\n  `;\n  const client = clientRows[0] ?? null;\n\n  const deals = client\n    ? await sql`SELECT * FROM pipeline_deals WHERE client_id = ${client.id} ORDER BY created_at DESC LIMIT 10`\n    : [];\n\n  const unreadMessages = client\n    ? await sql`SELECT COUNT(*) as count FROM messages WHERE client_id = ${client.id} AND sender_role = 'admin' AND read_at IS NULL`\n    : [{ count: '0' }];\n\n  const docCount = client\n    ? await sql`SELECT COUNT(*) as count FROM documents WHERE client_id = ${client.id}`\n    : [{ count: '0' }];\n\n  const totalValue = deals.reduce((sum: number, d: any) => sum + parseFloat(d.value || 0), 0);\n  const wonDeals = deals.filter((d: any) => d.stage === 'closed_won');\n\n  return (\n    <div className=\"p-8 max-w-5xl\">\n      {searchParams.admin === 'denied' && (\n        <div className=\"mb-6 flex items-center gap-3 bg-amber-50 border border-amber-200 rounded-lg px-4 py-3\">\n          <ShieldAlert className=\"w-5 h-5 text-amber-600 shrink-0\" />\n          <div>\n            <p className=\"text-sm font-semibold text-amber-900\">Admin access not granted</p>\n            <p className=\"text-xs text-amber-800 mt-0.5\">You were sent here because your account role is &quot;{appUser.role}&quot;, not &quot;admin&quot;. Only allowed admin emails get the Admin panel. Your email: {appUser.email}</p>\n          </div>\n        </div>\n      )}\n      {/* Header */}\n      <div className=\"mb-8\">\n        <span className=\"inline-block bg-red-600 text-white text-[9px] font-black uppercase tracking-[0.2em] px-2 py-1 mb-3\">\n          Dashboard\n        </span>\n        <h1 className=\"text-3xl font-black tracking-tighter text-zinc-900 uppercase italic\">\n          Welcome back{appUser.name ? `, ${appUser.name.split(' ')[0]}` : ''}.\n        </h1>\n        {client && (\n          <p className=\"text-zinc-600 text-sm mt-1\">{client.name}</p>\n        )}\n      </div>\n\n      {!client && (\n        <div className=\"bg-white border border-zinc-200 rounded-lg p-6 mb-8 shadow-sm\">\n          <p className=\"text-zinc-600 text-sm\">\n            Your account is pending client assignment. The Convivia24 team will link your pipeline shortly.\n          </p>\n        </div>\n      )}\n\n      {/* Stats */}\n      <div className=\"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8\">\n        {[\n          { label: 'Active Deals', value: deals.filter((d: any) => !['closed_won','closed_lost'].includes(d.stage)).length, icon: GitBranch },\n          { label: 'Total Value', value: `Â£${(totalValue / 1000).toFixed(0)}k`, icon: TrendingUp },\n          { label: 'Unread Messages', value: unreadMessages[0]?.count ?? 0, icon: MessageSquare },\n          { label: 'Documents', value: docCount[0]?.count ?? 0, icon: FileText },\n        ].map(({ label, value, icon: Icon }) => (\n          <div key={label} className=\"bg-white border border-zinc-200 rounded-lg p-5 shadow-sm\">\n            <Icon size={16} className=\"text-red-600 mb-3\" />\n            <p className=\"text-2xl font-black text-zinc-900 tracking-tighter\">{value}</p>\n            <p className=\"text-[11px] text-zinc-500 uppercase tracking-[0.15em] mt-1\">{label}</p>\n          </div>\n        ))}\n      </div>\n\n      {/* Recent Deals */}\n      {deals.length > 0 && (\n        <div className=\"bg-white border border-zinc-200 rounded-lg mb-6 shadow-sm\">\n          <div className=\"flex items-center justify-between px-6 py-4 border-b border-zinc-200\">\n            <h2 className=\"text-sm font-black uppercase tracking-[0.15em] text-zinc-900\">Recent Deals</h2>\n            <Link href=\"/dashboard/pipeline\" className=\"text-[11px] text-red-600 hover:text-red-700 flex items-center gap-1 transition-colors\">\n              View all <ArrowRight size={11} />\n            </Link>\n          </div>\n          <div className=\"divide-y divide-zinc-100\">\n            {deals.slice(0, 5).map((deal: any) => (\n              <div key={deal.id} className=\"flex items-center justify-between px-6 py-3.5\">\n                <div className=\"flex items-center gap-3\">\n                  <span className={`text-[9px] font-black uppercase tracking-[0.1em] text-white px-2 py-0.5 rounded ${STAGE_COLORS[deal.stage] || 'bg-zinc-600'}`}>\n                    {STAGE_LABELS[deal.stage] || deal.stage}\n                  </span>\n                  <span className=\"text-sm text-zinc-700\">{deal.title}</span>\n                </div>\n                {deal.value && (\n                  <span className=\"text-sm font-semibold text-zinc-900\">\n                    {deal.currency} {parseFloat(deal.value).toLocaleString()}\n                  </span>\n                )}\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Quick links */}\n      <div className=\"grid grid-cols-1 sm:grid-cols-3 gap-3\">\n        {[\n          { href: '/dashboard/pipeline',  label: 'View Pipeline',  sub: 'Track your deals' },\n          { href: '/dashboard/messages',  label: 'Messages',       sub: 'Talk to your team' },\n          { href: '/dashboard/documents', label: 'Documents',      sub: 'Files & reports' },\n        ].map(({ href, label, sub }) => (\n          <Link key={href} href={href}\n            className=\"group flex items-center justify-between bg-white border border-zinc-200 rounded-lg hover:border-red-300 hover:shadow-md px-5 py-4 transition-all\"\n          >\n            <div>\n              <p className=\"text-sm font-black uppercase tracking-[0.1em] text-zinc-900\">{label}</p>\n              <p className=\"text-[11px] text-zinc-500 mt-0.5\">{sub}</p>\n            </div>\n            <ArrowRight size={14} className=\"text-zinc-400 group-hover:text-red-500 transition-colors\" />\n          </Link>\n        ))}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}