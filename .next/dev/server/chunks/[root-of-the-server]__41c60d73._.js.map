{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/collinsnnaji/VSCodeDevelopments/convivia24/app/api/support/enquire/route.ts"],"sourcesContent":["import { neon } from '@neondatabase/serverless';\nimport { NextRequest, NextResponse } from 'next/server';\n\nconst databaseUrl = process.env.DATABASE_URL;\n\nexport async function POST(request: NextRequest) {\n  try {\n    // Check if database URL is configured\n    if (!databaseUrl) {\n      console.error('DATABASE_URL not configured');\n      return NextResponse.json(\n        { error: 'Server configuration error. Please contact support.' },\n        { status: 500 }\n      );\n    }\n\n    const body = await request.json();\n    const { name, email, subject, message } = body;\n\n    // Validate required fields\n    if (!name || !email || !subject || !message) {\n      return NextResponse.json(\n        { error: 'All fields are required' },\n        { status: 400 }\n      );\n    }\n\n    // Validate email format\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    if (!emailRegex.test(email)) {\n      return NextResponse.json(\n        { error: 'Please enter a valid email address' },\n        { status: 400 }\n      );\n    }\n\n    // Create Neon serverless client\n    const sql = neon(databaseUrl);\n\n    // Insert into enquiries table\n    const result = await sql`\n      INSERT INTO enquiries (name, email, subject, message, status)\n      VALUES (${name.trim()}, ${email.trim()}, ${subject.trim()}, ${message.trim()}, 'PENDING')\n      RETURNING id, name, email, subject, message, status, \"createdAt\"\n    `;\n\n    if (!result || result.length === 0) {\n      throw new Error('Failed to insert enquiry');\n    }\n\n    return NextResponse.json(\n      { success: true, message: 'Enquiry submitted successfully', data: result[0] },\n      { status: 201 }\n    );\n  } catch (error) {\n    console.error('API error:', error);\n    const errorMessage = error instanceof Error ? error.message : 'An unexpected error occurred';\n    \n    // Provide more specific error message for table not found\n    if (errorMessage.includes('relation') && errorMessage.includes('does not exist')) {\n      return NextResponse.json(\n        { error: 'Database table not found. Please ensure the enquiries table exists.' },\n        { status: 500 }\n      );\n    }\n\n    return NextResponse.json(\n      { error: errorMessage },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,YAAY;AAErC,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,sCAAsC;QACtC,IAAI,CAAC,aAAa;YAChB,QAAQ,KAAK,CAAC;YACd,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAsD,GAC/D;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,OAAO,EAAE,GAAG;QAE1C,2BAA2B;QAC3B,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,WAAW,CAAC,SAAS;YAC3C,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA0B,GACnC;gBAAE,QAAQ;YAAI;QAElB;QAEA,wBAAwB;QACxB,MAAM,aAAa;QACnB,IAAI,CAAC,WAAW,IAAI,CAAC,QAAQ;YAC3B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAqC,GAC9C;gBAAE,QAAQ;YAAI;QAElB;QAEA,gCAAgC;QAChC,MAAM,MAAM,IAAA,gKAAI,EAAC;QAEjB,8BAA8B;QAC9B,MAAM,SAAS,MAAM,GAAG,CAAC;;cAEf,EAAE,KAAK,IAAI,GAAG,EAAE,EAAE,MAAM,IAAI,GAAG,EAAE,EAAE,QAAQ,IAAI,GAAG,EAAE,EAAE,QAAQ,IAAI,GAAG;;IAE/E,CAAC;QAED,IAAI,CAAC,UAAU,OAAO,MAAM,KAAK,GAAG;YAClC,MAAM,IAAI,MAAM;QAClB;QAEA,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAM,SAAS;YAAkC,MAAM,MAAM,CAAC,EAAE;QAAC,GAC5E;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,cAAc;QAC5B,MAAM,eAAe,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAE9D,0DAA0D;QAC1D,IAAI,aAAa,QAAQ,CAAC,eAAe,aAAa,QAAQ,CAAC,mBAAmB;YAChF,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAsE,GAC/E;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAa,GACtB;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}