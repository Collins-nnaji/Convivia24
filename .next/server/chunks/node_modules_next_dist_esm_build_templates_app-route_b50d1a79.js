module.exports=[92828,e=>{"use strict";var s=e.i(47909),t=e.i(74017),a=e.i(96250),i=e.i(59756),n=e.i(61916),r=e.i(74677),o=e.i(69741),u=e.i(16795),d=e.i(87718),l=e.i(95169),c=e.i(47587),_=e.i(66012),b=e.i(70101),p=e.i(26937),m=e.i(10372),E=e.i(93695);e.i(52474);var R=e.i(220),O=e.i(89171),v=e.i(80998),y=e.i(71650);async function N(e){try{let s,t=await (0,y.authenticate)(e);if(t.error)return O.NextResponse.json({error:t.error},{status:t.status});let{user:a}=t,{searchParams:i}=new URL(e.url),n=i.get("status"),r=i.get("business_id");if(!v.sql){let e=[{id:"mock-1",business_id:"mock-business-1",service_id:"mock-service-1",requested_by:a.id,status:"pending",urgency:"routine",scheduled_start:new Date(Date.now()+864e5).toISOString(),scheduled_end:new Date(Date.now()+864e5+144e5).toISOString(),location_address:"123 Main Street, Lagos",special_instructions:"Please use eco-friendly cleaning products",total_cost:15e3,payment_status:"pending",business_name:"TechCorp Nigeria",service_name:"Routine Commercial Cleaning",service_type:"routine",requested_by_email:"client@techcorp.com",requested_by_first_name:"John",requested_by_last_name:"Doe",created_at:new Date().toISOString()},{id:"mock-2",business_id:"mock-business-2",service_id:"mock-service-2",requested_by:a.id,status:"in_progress",urgency:"urgent",scheduled_start:new Date().toISOString(),scheduled_end:new Date(Date.now()+72e5).toISOString(),location_address:"456 Business District, Abuja",special_instructions:null,total_cost:35e3,payment_status:"pending",business_name:"Healthcare Plus",service_name:"Rapid Response & Emergency Cleaning",service_type:"rapid",requested_by_email:"admin@healthcare.com",requested_by_first_name:"Sarah",requested_by_last_name:"Johnson",created_at:new Date(Date.now()-36e5).toISOString()},{id:"mock-3",business_id:"mock-business-3",service_id:"mock-service-3",requested_by:a.id,status:"completed",urgency:"routine",scheduled_start:new Date(Date.now()-1728e5).toISOString(),scheduled_end:new Date(Date.now()-1728e5+288e5).toISOString(),actual_start:new Date(Date.now()-1728e5).toISOString(),actual_end:new Date(Date.now()-1728e5+288e5).toISOString(),location_address:"789 Corporate Plaza, Victoria Island",special_instructions:"Deep clean required",total_cost:5e4,payment_status:"paid",business_name:"Finance Hub Ltd",service_name:"Deep Cleaning & Sanitation Reset",service_type:"deep",requested_by_email:"facilities@financehub.com",requested_by_first_name:"Michael",requested_by_last_name:"Chen",created_at:new Date(Date.now()-2592e5).toISOString()}],s=e;return"client"===a.role?s=e.filter(e=>e.business_id===a.business_id):("staff"===a.role||"supervisor"===a.role)&&(s=e.slice(0,2)),n&&"all"!==n&&(s=s.filter(e=>e.status===n)),O.NextResponse.json({bookings:s})}if("admin"===a.role)s=n&&r?await v.sql`
          SELECT 
            b.*,
            bs.name as business_name,
            s.name as service_name,
            s.type as service_type,
            u.email as requested_by_email,
            u.first_name as requested_by_first_name,
            u.last_name as requested_by_last_name
          FROM bookings b
          LEFT JOIN businesses bs ON b.business_id = bs.id
          LEFT JOIN services s ON b.service_id = s.id
          LEFT JOIN users u ON b.requested_by = u.id
          WHERE b.status = ${n} AND b.business_id = ${r}
          ORDER BY b.created_at DESC
          LIMIT 100
        `:n?await v.sql`
          SELECT 
            b.*,
            bs.name as business_name,
            s.name as service_name,
            s.type as service_type,
            u.email as requested_by_email,
            u.first_name as requested_by_first_name,
            u.last_name as requested_by_last_name
          FROM bookings b
          LEFT JOIN businesses bs ON b.business_id = bs.id
          LEFT JOIN services s ON b.service_id = s.id
          LEFT JOIN users u ON b.requested_by = u.id
          WHERE b.status = ${n}
          ORDER BY b.created_at DESC
          LIMIT 100
        `:r?await v.sql`
          SELECT 
            b.*,
            bs.name as business_name,
            s.name as service_name,
            s.type as service_type,
            u.email as requested_by_email,
            u.first_name as requested_by_first_name,
            u.last_name as requested_by_last_name
          FROM bookings b
          LEFT JOIN businesses bs ON b.business_id = bs.id
          LEFT JOIN services s ON b.service_id = s.id
          LEFT JOIN users u ON b.requested_by = u.id
          WHERE b.business_id = ${r}
          ORDER BY b.created_at DESC
          LIMIT 100
        `:await v.sql`
          SELECT 
            b.*,
            bs.name as business_name,
            s.name as service_name,
            s.type as service_type,
            u.email as requested_by_email,
            u.first_name as requested_by_first_name,
            u.last_name as requested_by_last_name
          FROM bookings b
          LEFT JOIN businesses bs ON b.business_id = bs.id
          LEFT JOIN services s ON b.service_id = s.id
          LEFT JOIN users u ON b.requested_by = u.id
          ORDER BY b.created_at DESC
          LIMIT 100
        `;else if("client"===a.role)s=n?await v.sql`
          SELECT 
            b.*,
            bs.name as business_name,
            s.name as service_name,
            s.type as service_type,
            u.email as requested_by_email,
            u.first_name as requested_by_first_name,
            u.last_name as requested_by_last_name
          FROM bookings b
          LEFT JOIN businesses bs ON b.business_id = bs.id
          LEFT JOIN services s ON b.service_id = s.id
          LEFT JOIN users u ON b.requested_by = u.id
          WHERE b.business_id = ${a.business_id} AND b.status = ${n}
          ORDER BY b.created_at DESC
        `:await v.sql`
          SELECT 
            b.*,
            bs.name as business_name,
            s.name as service_name,
            s.type as service_type,
            u.email as requested_by_email,
            u.first_name as requested_by_first_name,
            u.last_name as requested_by_last_name
          FROM bookings b
          LEFT JOIN businesses bs ON b.business_id = bs.id
          LEFT JOIN services s ON b.service_id = s.id
          LEFT JOIN users u ON b.requested_by = u.id
          WHERE b.business_id = ${a.business_id}
          ORDER BY b.created_at DESC
        `;else{if("staff"!==a.role&&"supervisor"!==a.role)return O.NextResponse.json({error:"Unauthorized"},{status:403});s=n?await v.sql`
          SELECT DISTINCT
            b.*,
            bs.name as business_name,
            s.name as service_name,
            s.type as service_type,
            sa.status as assignment_status,
            sa.assigned_at
          FROM bookings b
          LEFT JOIN businesses bs ON b.business_id = bs.id
          LEFT JOIN services s ON b.service_id = s.id
          LEFT JOIN staff_assignments sa ON b.id = sa.booking_id
          WHERE (sa.staff_id = ${a.id} OR sa.supervisor_id = ${a.id}) AND b.status = ${n}
          ORDER BY b.scheduled_start DESC, b.created_at DESC
        `:await v.sql`
          SELECT DISTINCT
            b.*,
            bs.name as business_name,
            s.name as service_name,
            s.type as service_type,
            sa.status as assignment_status,
            sa.assigned_at
          FROM bookings b
          LEFT JOIN businesses bs ON b.business_id = bs.id
          LEFT JOIN services s ON b.service_id = s.id
          LEFT JOIN staff_assignments sa ON b.id = sa.booking_id
          WHERE sa.staff_id = ${a.id} OR sa.supervisor_id = ${a.id}
          ORDER BY b.scheduled_start DESC, b.created_at DESC
        `}return O.NextResponse.json({bookings:s})}catch(e){return console.error("Get bookings error:",e),O.NextResponse.json({error:"Failed to fetch bookings"},{status:500})}}async function g(e){try{let s=await (0,y.authenticate)(e);if(s.error)return O.NextResponse.json({error:s.error},{status:s.status});let{user:t}=s;if("client"!==t.role)return O.NextResponse.json({error:"Only clients can create bookings"},{status:403});let{service_id:a,urgency:i="routine",scheduled_start:n,scheduled_end:r,location_address:o,special_instructions:u,total_cost:d}=await e.json();if(!a||!o)return O.NextResponse.json({error:"Service ID and location address are required"},{status:400});let[l]=await v.sql`
      SELECT * FROM services WHERE id = ${a} AND is_active = true
    `;if(!l)return O.NextResponse.json({error:"Service not found or inactive"},{status:404});let c=d||l.base_price;"urgent"===i?c*=1.5:"emergency"===i&&(c*=2);let[_]=await v.sql`
      INSERT INTO bookings (
        business_id, service_id, requested_by, urgency, 
        scheduled_start, scheduled_end, location_address, 
        special_instructions, total_cost, status
      )
      VALUES (
        ${t.business_id},
        ${a},
        ${t.id},
        ${i},
        ${n||null},
        ${r||null},
        ${o},
        ${u||null},
        ${c},
        ${"pending"}
      )
      RETURNING *
    `,[b]=await v.sql`
      SELECT 
        b.*,
        bs.name as business_name,
        s.name as service_name,
        s.type as service_type,
        u.email as requested_by_email
      FROM bookings b
      LEFT JOIN businesses bs ON b.business_id = bs.id
      LEFT JOIN services s ON b.service_id = s.id
      LEFT JOIN users u ON b.requested_by = u.id
      WHERE b.id = ${_.id}
    `;return O.NextResponse.json({booking:b},{status:201})}catch(e){return console.error("Create booking error:",e),O.NextResponse.json({error:"Failed to create booking"},{status:500})}}e.s(["GET",()=>N,"POST",()=>g],1194);var h=e.i(1194);let f=new s.AppRouteRouteModule({definition:{kind:t.RouteKind.APP_ROUTE,page:"/api/bookings/route",pathname:"/api/bookings",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/bookings/route.js",nextConfigOutput:"",userland:h}),{workAsyncStorage:T,workUnitAsyncStorage:w,serverHooks:S}=f;function I(){return(0,a.patchFetch)({workAsyncStorage:T,workUnitAsyncStorage:w})}async function q(e,s,a){f.isDev&&(0,i.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let O="/api/bookings/route";O=O.replace(/\/index$/,"")||"/";let v=await f.prepare(e,s,{srcPage:O,multiZoneDraftMode:!1});if(!v)return s.statusCode=400,s.end("Bad Request"),null==a.waitUntil||a.waitUntil.call(a,Promise.resolve()),null;let{buildId:y,params:N,nextConfig:g,parsedUrl:h,isDraftMode:T,prerenderManifest:w,routerServerContext:S,isOnDemandRevalidate:I,revalidateOnlyGenerated:q,resolvedPathname:C,clientReferenceManifest:D,serverActionsManifest:L}=v,F=(0,o.normalizeAppPath)(O),k=!!(w.dynamicRoutes[F]||w.routes[C]),x=async()=>((null==S?void 0:S.render404)?await S.render404(e,s,h,!1):s.end("This page could not be found"),null);if(k&&!T){let e=!!w.routes[C],s=w.dynamicRoutes[F];if(s&&!1===s.fallback&&!e){if(g.experimental.adapterPath)return await x();throw new E.NoFallbackError}}let A=null;!k||f.isDev||T||(A="/index"===(A=C)?"/":A);let $=!0===f.isDev||!k,J=k&&!$;L&&D&&(0,r.setManifestsSingleton)({page:O,clientReferenceManifest:D,serverActionsManifest:L});let H=e.method||"GET",M=(0,n.getTracer)(),P=M.getActiveScopeSpan(),j={params:N,prerenderManifest:w,renderOpts:{experimental:{authInterrupts:!!g.experimental.authInterrupts},cacheComponents:!!g.cacheComponents,supportsDynamicResponse:$,incrementalCache:(0,i.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:g.cacheLife,waitUntil:a.waitUntil,onClose:e=>{s.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(s,t,a,i)=>f.onRequestError(e,s,a,i,S)},sharedContext:{buildId:y}},U=new u.NodeNextRequest(e),B=new u.NodeNextResponse(s),W=d.NextRequestAdapter.fromNodeNextRequest(U,(0,d.signalFromNodeResponse)(s));try{let r=async e=>f.handle(W,j).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":s.statusCode,"next.rsc":!1});let t=M.getRootSpanAttributes();if(!t)return;if(t.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${t.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let a=t.get("next.route");if(a){let s=`${H} ${a}`;e.setAttributes({"next.route":a,"http.route":a,"next.span_name":s}),e.updateName(s)}else e.updateName(`${H} ${O}`)}),o=!!(0,i.getRequestMeta)(e,"minimalMode"),u=async i=>{var n,u;let d=async({previousCacheEntry:t})=>{try{if(!o&&I&&q&&!t)return s.statusCode=404,s.setHeader("x-nextjs-cache","REVALIDATED"),s.end("This page could not be found"),null;let n=await r(i);e.fetchMetrics=j.renderOpts.fetchMetrics;let u=j.renderOpts.pendingWaitUntil;u&&a.waitUntil&&(a.waitUntil(u),u=void 0);let d=j.renderOpts.collectedTags;if(!k)return await (0,_.sendResponse)(U,B,n,j.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),s=(0,b.toNodeOutgoingHttpHeaders)(n.headers);d&&(s[m.NEXT_CACHE_TAGS_HEADER]=d),!s["content-type"]&&e.type&&(s["content-type"]=e.type);let t=void 0!==j.renderOpts.collectedRevalidate&&!(j.renderOpts.collectedRevalidate>=m.INFINITE_CACHE)&&j.renderOpts.collectedRevalidate,a=void 0===j.renderOpts.collectedExpire||j.renderOpts.collectedExpire>=m.INFINITE_CACHE?void 0:j.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:s},cacheControl:{revalidate:t,expire:a}}}}catch(s){throw(null==t?void 0:t.isStale)&&await f.onRequestError(e,s,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:J,isOnDemandRevalidate:I})},!1,S),s}},l=await f.handleResponse({req:e,nextConfig:g,cacheKey:A,routeKind:t.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:w,isRoutePPREnabled:!1,isOnDemandRevalidate:I,revalidateOnlyGenerated:q,responseGenerator:d,waitUntil:a.waitUntil,isMinimalMode:o});if(!k)return null;if((null==l||null==(n=l.value)?void 0:n.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(u=l.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||s.setHeader("x-nextjs-cache",I?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),T&&s.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let E=(0,b.fromNodeOutgoingHttpHeaders)(l.value.headers);return o&&k||E.delete(m.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||s.getHeader("Cache-Control")||E.get("Cache-Control")||E.set("Cache-Control",(0,p.getCacheControlHeader)(l.cacheControl)),await (0,_.sendResponse)(U,B,new Response(l.value.body,{headers:E,status:l.value.status||200})),null};P?await u(P):await M.withPropagatedContext(e.headers,()=>M.trace(l.BaseServerSpan.handleRequest,{spanName:`${H} ${O}`,kind:n.SpanKind.SERVER,attributes:{"http.method":H,"http.target":e.url}},u))}catch(s){if(s instanceof E.NoFallbackError||await f.onRequestError(e,s,{routerKind:"App Router",routePath:F,routeType:"route",revalidateReason:(0,c.getRevalidateReason)({isStaticGeneration:J,isOnDemandRevalidate:I})},!1,S),k)throw s;return await (0,_.sendResponse)(U,B,new Response(null,{status:500})),null}}e.s(["handler",()=>q,"patchFetch",()=>I,"routeModule",()=>f,"serverHooks",()=>S,"workAsyncStorage",()=>T,"workUnitAsyncStorage",()=>w],92828)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_b50d1a79.js.map