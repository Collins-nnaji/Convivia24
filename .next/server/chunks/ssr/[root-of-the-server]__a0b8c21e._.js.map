{"version":3,"sources":["../../../../app/admin/clients/%5Bid%5D/messages.tsx/__nextjs-internal-proxy.mjs","../../../../app/admin/clients/%5Bid%5D/deals.tsx/__nextjs-internal-proxy.mjs","../../../../app/admin/clients/%5Bid%5D/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/admin/clients/[id]/messages.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/admin/clients/[id]/messages.tsx\",\n    \"default\",\n);\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/admin/clients/[id]/deals.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/admin/clients/[id]/deals.tsx\",\n    \"default\",\n);\n","import { requireAdmin } from '@/lib/auth/session';\nimport sql from '@/lib/db';\nimport { notFound } from 'next/navigation';\nimport Link from 'next/link';\nimport AdminClientMessages from './messages';\nimport AdminDealManager from './deals';\n\ntype ClientRow = { id: string; name: string; industry?: string | null; contact_email?: string | null; contact_phone?: string | null; status: string };\n\nexport default async function ClientDetailPage({ params }: { params: Promise<{ id: string }> }) {\n  await requireAdmin();\n  const { id } = await params;\n\n  const rows = await sql`SELECT * FROM clients WHERE id = ${id}`;\n  const client = rows[0] as ClientRow | undefined;\n  if (!client) notFound();\n\n  const [deals, messages, docs, linkedUsers] = await Promise.all([\n    sql`SELECT * FROM pipeline_deals WHERE client_id = ${id} ORDER BY created_at DESC`,\n    sql`\n      SELECT m.*, u.name as sender_name, u.image as sender_image\n      FROM messages m\n      JOIN app_users u ON u.id = m.sender_id\n      WHERE m.client_id = ${id}\n      ORDER BY m.created_at ASC\n    `,\n    sql`SELECT * FROM documents WHERE client_id = ${id} ORDER BY created_at DESC`,\n    sql`\n      SELECT u.* FROM app_users u\n      JOIN client_users cu ON cu.user_id = u.id\n      WHERE cu.client_id = ${id}\n    `,\n  ]);\n\n  const STAGE_COLORS: Record<string, string> = {\n    lead: 'bg-zinc-700', qualified: 'bg-blue-700', proposal: 'bg-yellow-600',\n    negotiation: 'bg-orange-600', closed_won: 'bg-green-700', closed_lost: 'bg-zinc-600',\n  };\n\n  return (\n    <div className=\"p-8 max-w-6xl\">\n      {/* Header */}\n      <div className=\"mb-8\">\n        <Link href=\"/admin/clients\" className=\"text-[11px] text-zinc-500 hover:text-white transition-colors mb-4 block\">\n          ← All Clients\n        </Link>\n        <div className=\"flex items-start justify-between\">\n          <div>\n            <span className=\"inline-block bg-red-700 text-white text-[9px] font-black uppercase tracking-[0.2em] px-2 py-1 mb-3\">\n              Client\n            </span>\n            <h1 className=\"text-3xl font-black tracking-tighter text-white uppercase italic\">{client.name}</h1>\n            <div className=\"flex items-center gap-3 mt-2\">\n              {client.industry && <span className=\"text-zinc-500 text-sm\">{client.industry}</span>}\n              {client.contact_email && <span className=\"text-zinc-600 text-sm\">{client.contact_email}</span>}\n              <span className={`text-[9px] font-black uppercase tracking-[0.1em] px-2 py-0.5 ${client.status === 'active' ? 'bg-green-900 text-green-400' : 'bg-zinc-800 text-zinc-500'}`}>\n                {client.status}\n              </span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Deals */}\n        <div className=\"bg-zinc-900 border border-zinc-800\">\n          <div className=\"px-6 py-4 border-b border-zinc-800\">\n            <h2 className=\"text-sm font-black uppercase tracking-[0.15em] text-white\">Pipeline Deals</h2>\n          </div>\n          <AdminDealManager clientId={id} deals={deals as any[]} />\n        </div>\n\n        {/* Messages */}\n        <div className=\"bg-zinc-900 border border-zinc-800\">\n          <div className=\"px-6 py-4 border-b border-zinc-800\">\n            <h2 className=\"text-sm font-black uppercase tracking-[0.15em] text-white\">Messages</h2>\n          </div>\n          <AdminClientMessages clientId={id} initialMessages={messages as any[]} />\n        </div>\n\n        {/* Documents */}\n        <div className=\"bg-zinc-900 border border-zinc-800\">\n          <div className=\"px-6 py-4 border-b border-zinc-800\">\n            <h2 className=\"text-sm font-black uppercase tracking-[0.15em] text-white\">Documents ({docs.length})</h2>\n          </div>\n          <div className=\"divide-y divide-zinc-800 max-h-64 overflow-auto\">\n            {docs.length === 0 && <p className=\"text-zinc-600 text-sm text-center py-6\">No documents</p>}\n            {docs.map((doc: any) => (\n              <div key={doc.id} className=\"flex items-center justify-between px-6 py-3\">\n                <p className=\"text-sm text-zinc-300 truncate\">{doc.name}</p>\n                <a href={doc.url} target=\"_blank\" rel=\"noopener noreferrer\"\n                  className=\"text-[11px] text-red-500 hover:text-red-400 shrink-0 ml-2\">\n                  Download →\n                </a>\n              </div>\n            ))}\n          </div>\n        </div>\n\n        {/* Linked Users */}\n        <div className=\"bg-zinc-900 border border-zinc-800\">\n          <div className=\"px-6 py-4 border-b border-zinc-800\">\n            <h2 className=\"text-sm font-black uppercase tracking-[0.15em] text-white\">Linked Users</h2>\n          </div>\n          <div className=\"divide-y divide-zinc-800\">\n            {linkedUsers.length === 0 && <p className=\"text-zinc-600 text-sm text-center py-6\">No users linked</p>}\n            {linkedUsers.map((u: any) => (\n              <div key={u.id} className=\"flex items-center gap-3 px-6 py-3\">\n                <div className=\"w-7 h-7 rounded-full bg-red-700 flex items-center justify-center text-white text-xs font-black shrink-0\">\n                  {(u.name || u.email || 'U')[0].toUpperCase()}\n                </div>\n                <div>\n                  <p className=\"text-sm text-white\">{u.name || 'No name'}</p>\n                  <p className=\"text-[11px] text-zinc-500\">{u.email}</p>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","ignoreList":[0,1]}