{"version":3,"sources":["../../../../app/admin/listings/ListingsFilters.tsx/__nextjs-internal-proxy.mjs","../../../../app/admin/listings/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ListingsFilters = registerClientReference(\n    function() { throw new Error(\"Attempted to call ListingsFilters() from the server but ListingsFilters is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/admin/listings/ListingsFilters.tsx\",\n    \"ListingsFilters\",\n);\n","import { requireAdmin } from '@/lib/auth/session';\nimport sql from '@/lib/db';\nimport Link from 'next/link';\nimport { ListingsFilters } from './ListingsFilters';\n\nexport default async function AdminListingsPage(props: { searchParams: Promise<{ client_id?: string; status?: string }> }) {\n  await requireAdmin();\n  const searchParams = await props.searchParams;\n  const clientId = searchParams.client_id ?? null;\n  const status = searchParams.status ?? null;\n\n  const clients = await sql`SELECT id, name FROM clients ORDER BY name`;\n\n  let listings: Record<string, unknown>[];\n  if (clientId && status) {\n    listings = (await sql`\n      SELECT l.*, c.name as client_name\n      FROM listings l\n      JOIN clients c ON c.id = l.client_id\n      WHERE l.client_id = ${clientId} AND l.status = ${status}\n      ORDER BY l.updated_at DESC\n    `) as Record<string, unknown>[];\n  } else if (clientId) {\n    listings = (await sql`\n      SELECT l.*, c.name as client_name\n      FROM listings l\n      JOIN clients c ON c.id = l.client_id\n      WHERE l.client_id = ${clientId}\n      ORDER BY l.updated_at DESC\n    `) as Record<string, unknown>[];\n  } else if (status) {\n    listings = (await sql`\n      SELECT l.*, c.name as client_name\n      FROM listings l\n      JOIN clients c ON c.id = l.client_id\n      WHERE l.status = ${status}\n      ORDER BY l.updated_at DESC\n    `) as Record<string, unknown>[];\n  } else {\n    listings = (await sql`\n      SELECT l.*, c.name as client_name\n      FROM listings l\n      JOIN clients c ON c.id = l.client_id\n      ORDER BY l.updated_at DESC\n    `) as Record<string, unknown>[];\n  }\n\n  const STATUS_LABELS: Record<string, string> = {\n    draft: 'Draft',\n    submitted: 'Submitted',\n    price_agreed: 'Price agreed',\n    listed: 'Listed',\n    sold: 'Sold',\n    withdrawn: 'Withdrawn',\n  };\n\n  function formatPrice(value: unknown, currency: string): string {\n    if (value == null || value === '') return '—';\n    const n = typeof value === 'string' ? parseFloat(value) : Number(value);\n    if (isNaN(n)) return '—';\n    return `${currency === 'GBP' ? '£' : currency + ' '}${n.toLocaleString()}`;\n  }\n\n  function relativeDate(dateStr: string): string {\n    const d = new Date(dateStr);\n    const now = new Date();\n    const diffMs = now.getTime() - d.getTime();\n    const diffDays = Math.floor(diffMs / (24 * 60 * 60 * 1000));\n    if (diffDays === 0) return 'Today';\n    if (diffDays === 1) return 'Yesterday';\n    if (diffDays < 7) return `${diffDays} days ago`;\n    if (diffDays < 30) return `${Math.floor(diffDays / 7)} weeks ago`;\n    return d.toLocaleDateString('en-GB');\n  }\n\n  const countDraft = listings.filter((l) => String(l.status) === 'draft').length;\n  const countInProgress = listings.filter((l) => ['submitted', 'price_agreed', 'listed'].includes(String(l.status))).length;\n  const countSold = listings.filter((l) => String(l.status) === 'sold').length;\n\n  return (\n    <div className=\"p-8\">\n      <div className=\"mb-8\">\n        <span className=\"inline-block bg-red-700 text-white text-[9px] font-black uppercase tracking-[0.2em] px-2 py-1 mb-3\">\n          Listings\n        </span>\n        <h1 className=\"text-3xl font-black tracking-tighter text-white uppercase italic\">\n          Items to sell\n        </h1>\n        <p className=\"text-zinc-500 text-sm mt-1\">\n          Partner listings: agree price and commission in Messages, then set agreed terms and mark sold here.\n        </p>\n      </div>\n\n      <ListingsFilters clients={clients as { id: string; name: string }[]} currentClientId={clientId} currentStatus={status} />\n\n      {listings.length > 0 && (\n        <div className=\"flex flex-wrap gap-4 mt-4 mb-3 text-sm\">\n          <span className=\"text-zinc-400\">\n            <strong className=\"text-zinc-200\">{listings.length}</strong> showing\n          </span>\n          {countDraft > 0 && <span className=\"text-zinc-500\">{countDraft} draft</span>}\n          {countInProgress > 0 && <span className=\"text-zinc-500\">{countInProgress} in progress</span>}\n          {countSold > 0 && <span className=\"text-zinc-500\">{countSold} sold</span>}\n        </div>\n      )}\n\n      <div className=\"bg-zinc-900 border border-zinc-800 mt-2\">\n        {listings.length === 0 ? (\n          <p className=\"text-zinc-600 text-sm text-center py-12\">No listings match the filters.</p>\n        ) : (\n          <div className=\"divide-y divide-zinc-800\">\n            {listings.map((l) => (\n              <Link\n                key={String(l.id)}\n                href={`/admin/listings/${l.id}`}\n                className=\"flex flex-wrap items-center justify-between gap-4 px-6 py-4 hover:bg-zinc-800 transition-colors\"\n              >\n                <div className=\"min-w-0\">\n                  <div className=\"flex flex-wrap items-center gap-2 mb-0.5\">\n                    <p className=\"text-sm font-semibold text-white truncate\">{String(l.title)}</p>\n                    <span className=\"text-[10px] text-zinc-500 shrink-0\">{relativeDate(String(l.updated_at))}</span>\n                  </div>\n                  <p className=\"text-[11px] text-zinc-500 truncate\">{String(l.client_name)}</p>\n                  <div className=\"flex flex-wrap gap-3 mt-1 text-[11px] text-zinc-400\">\n                    <span>Asking: {formatPrice(l.asking_price, String(l.currency ?? 'GBP'))}</span>\n                    {l.agreed_price != null && l.agreed_price !== '' && (\n                      <span>Agreed: {formatPrice(l.agreed_price, String(l.currency ?? 'GBP'))}</span>\n                    )}\n                    {l.agreed_commission_pct != null && l.agreed_commission_pct !== '' && (\n                      <span>Commission: {Number(l.agreed_commission_pct)}%</span>\n                    )}\n                  </div>\n                </div>\n                <div className=\"flex items-center gap-3\">\n                  <span className=\"text-[10px] font-black uppercase px-2 py-0.5 rounded bg-zinc-700 text-zinc-300\">\n                    {STATUS_LABELS[String(l.status)] ?? String(l.status)}\n                  </span>\n                  <span className=\"text-zinc-600\">→</span>\n                </div>\n              </Link>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}