{"version":3,"sources":["../../../../app/admin/listings/%5Bid%5D/ListingAgreeForm.tsx","../../../../app/admin/listings/%5Bid%5D/ListingMarkSoldForm.tsx"],"sourcesContent":["'use client';\n\nimport { useState } from 'react';\nimport { useRouter } from 'next/navigation';\n\nexport function ListingAgreeForm({\n  listingId,\n  currentStatus,\n  agreedPrice,\n  agreedCommissionPct,\n  currency,\n}: {\n  listingId: string;\n  currentStatus: string;\n  agreedPrice: unknown;\n  agreedCommissionPct: unknown;\n  currency: string;\n}) {\n  const router = useRouter();\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [agreedPriceVal, setAgreedPriceVal] = useState(\n    agreedPrice != null && agreedPrice !== '' ? String(agreedPrice) : ''\n  );\n  const [commissionVal, setCommissionVal] = useState(\n    agreedCommissionPct != null && agreedCommissionPct !== '' ? String(agreedCommissionPct) : ''\n  );\n\n  async function handleAgree(e: React.FormEvent) {\n    e.preventDefault();\n    setError('');\n    setLoading(true);\n    try {\n      const body: { agreed_price?: number; agreed_commission_pct?: number; status: string } = {\n        status: 'price_agreed',\n      };\n      if (agreedPriceVal) body.agreed_price = Number(agreedPriceVal);\n      if (commissionVal) body.agreed_commission_pct = Number(commissionVal);\n      const res = await fetch(`/api/listings/${listingId}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify(body),\n      });\n      if (!res.ok) {\n        const data = await res.json().catch(() => ({}));\n        setError(data?.error ?? 'Failed to update');\n        setLoading(false);\n        return;\n      }\n      router.refresh();\n    } catch {\n      setError('Network error');\n    }\n    setLoading(false);\n  }\n\n  async function handleSetListed() {\n    setError('');\n    setLoading(true);\n    try {\n      const res = await fetch(`/api/listings/${listingId}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({ status: 'listed' }),\n      });\n      if (!res.ok) {\n        const data = await res.json().catch(() => ({}));\n        setError(data?.error ?? 'Failed to update');\n        setLoading(false);\n        return;\n      }\n      router.refresh();\n    } catch {\n      setError('Network error');\n    }\n    setLoading(false);\n  }\n\n  return (\n    <div>\n      <h2 className=\"text-sm font-black uppercase tracking-[0.15em] text-zinc-400 mb-3\">Set agreed terms</h2>\n      {error && <p className=\"text-red-400 text-sm mb-3\">{error}</p>}\n      <form onSubmit={handleAgree} className=\"flex flex-wrap items-end gap-4\">\n        <div>\n          <label htmlFor=\"agreed_price\" className=\"block text-[11px] text-zinc-500 uppercase font-bold mb-1\">\n            Agreed price ({currency})\n          </label>\n          <input\n            id=\"agreed_price\"\n            type=\"number\"\n            min=\"0\"\n            step=\"0.01\"\n            value={agreedPriceVal}\n            onChange={(e) => setAgreedPriceVal(e.target.value)}\n            className=\"bg-zinc-800 border border-zinc-700 text-white text-sm px-3 py-2 rounded w-32 focus:outline-none focus:ring-1 focus:ring-red-600\"\n          />\n        </div>\n        <div>\n          <label htmlFor=\"commission_pct\" className=\"block text-[11px] text-zinc-500 uppercase font-bold mb-1\">\n            Commission %\n          </label>\n          <input\n            id=\"commission_pct\"\n            type=\"number\"\n            min=\"0\"\n            max=\"100\"\n            step=\"0.5\"\n            value={commissionVal}\n            onChange={(e) => setCommissionVal(e.target.value)}\n            className=\"bg-zinc-800 border border-zinc-700 text-white text-sm px-3 py-2 rounded w-24 focus:outline-none focus:ring-1 focus:ring-red-600\"\n          />\n        </div>\n        <button\n          type=\"submit\"\n          disabled={loading}\n          className=\"bg-red-700 hover:bg-red-600 text-white text-sm font-bold uppercase px-4 py-2 rounded transition-colors disabled:opacity-60\"\n        >\n          {loading ? 'Saving…' : 'Mark as agreed'}\n        </button>\n        {(currentStatus === 'price_agreed' || currentStatus === 'listed') && (\n          <button\n            type=\"button\"\n            onClick={handleSetListed}\n            disabled={loading || currentStatus === 'listed'}\n            className=\"border border-zinc-600 text-zinc-300 text-sm font-semibold px-4 py-2 rounded hover:bg-zinc-800 transition-colors disabled:opacity-50\"\n          >\n            {currentStatus === 'listed' ? 'Listed' : 'Mark as listed'}\n          </button>\n        )}\n      </form>\n    </div>\n  );\n}\n","'use client';\n\nimport { useState } from 'react';\nimport { useRouter } from 'next/navigation';\n\nexport function ListingMarkSoldForm({ listingId, currency }: { listingId: string; currency: string }) {\n  const router = useRouter();\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [saleValue, setSaleValue] = useState('');\n\n  async function handleMarkSold(e: React.FormEvent) {\n    e.preventDefault();\n    setError('');\n    const value = saleValue ? Number(saleValue) : undefined;\n    if (value != null && (isNaN(value) || value < 0)) {\n      setError('Enter a valid sale value.');\n      return;\n    }\n    setLoading(true);\n    try {\n      const res = await fetch(`/api/listings/${listingId}`, {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        credentials: 'include',\n        body: JSON.stringify({ status: 'sold', sale_value: value ?? null }),\n      });\n      if (!res.ok) {\n        const data = await res.json().catch(() => ({}));\n        setError(data?.error ?? 'Failed to update');\n        setLoading(false);\n        return;\n      }\n      router.refresh();\n    } catch {\n      setError('Network error');\n    }\n    setLoading(false);\n  }\n\n  return (\n    <div>\n      <h2 className=\"text-sm font-black uppercase tracking-[0.15em] text-zinc-400 mb-3\">Mark as sold</h2>\n      {error && <p className=\"text-red-400 text-sm mb-3\">{error}</p>}\n      <form onSubmit={handleMarkSold} className=\"flex flex-wrap items-end gap-4\">\n        <div>\n          <label htmlFor=\"sale_value\" className=\"block text-[11px] text-zinc-500 uppercase font-bold mb-1\">\n            Sale value ({currency})\n          </label>\n          <input\n            id=\"sale_value\"\n            type=\"number\"\n            min=\"0\"\n            step=\"0.01\"\n            value={saleValue}\n            onChange={(e) => setSaleValue(e.target.value)}\n            placeholder=\"Final sale amount\"\n            className=\"bg-zinc-800 border border-zinc-700 text-white text-sm px-3 py-2 rounded w-40 focus:outline-none focus:ring-1 focus:ring-red-600\"\n          />\n        </div>\n        <button\n          type=\"submit\"\n          disabled={loading}\n          className=\"bg-green-700 hover:bg-green-600 text-white text-sm font-bold uppercase px-4 py-2 rounded transition-colors disabled:opacity-60\"\n        >\n          {loading ? 'Saving…' : 'Mark sold'}\n        </button>\n      </form>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}