{"version":3,"sources":["../../../../app/admin/pipeline/page.tsx"],"sourcesContent":["import { requireAdmin } from '@/lib/auth/session';\nimport sql from '@/lib/db';\nimport Link from 'next/link';\n\nconst STAGES = [\n  { key: 'lead',         label: 'Lead',         color: 'border-zinc-600' },\n  { key: 'qualified',    label: 'Qualified',    color: 'border-blue-600' },\n  { key: 'proposal',     label: 'Proposal',     color: 'border-yellow-500' },\n  { key: 'negotiation',  label: 'Negotiation',  color: 'border-orange-500' },\n  { key: 'closed_won',   label: 'Won',          color: 'border-green-600' },\n  { key: 'closed_lost',  label: 'Lost',         color: 'border-zinc-700' },\n];\n\nexport default async function AdminPipelinePage() {\n  await requireAdmin();\n\n  const deals = await sql`\n    SELECT d.*, c.name as client_name\n    FROM pipeline_deals d\n    JOIN clients c ON c.id = d.client_id\n    ORDER BY d.updated_at DESC\n  `;\n\n  const byStage = STAGES.reduce((acc: Record<string, any[]>, s) => {\n    acc[s.key] = deals.filter((d: any) => d.stage === s.key);\n    return acc;\n  }, {});\n\n  const totalOpen = deals.filter((d: any) => !['closed_won','closed_lost'].includes(d.stage));\n  const totalValue = totalOpen.reduce((sum: number, d: any) => sum + parseFloat(d.value || 0), 0);\n\n  return (\n    <div className=\"p-8\">\n      <div className=\"mb-8\">\n        <span className=\"inline-block bg-red-700 text-white text-[9px] font-black uppercase tracking-[0.2em] px-2 py-1 mb-3\">\n          Pipeline\n        </span>\n        <h1 className=\"text-3xl font-black tracking-tighter text-white uppercase italic\">\n          All Deals\n        </h1>\n        <p className=\"text-zinc-500 text-sm mt-1\">\n          {totalOpen.length} open deals · £{(totalValue / 1000).toFixed(0)}k pipeline value\n        </p>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4\">\n        {STAGES.map(({ key, label, color }) => (\n          <div key={key} className={`bg-zinc-900 border-t-2 ${color} border-x border-b border-zinc-800`}>\n            <div className=\"px-4 py-3 border-b border-zinc-800 flex items-center justify-between\">\n              <span className=\"text-xs font-black uppercase tracking-[0.15em] text-zinc-300\">{label}</span>\n              <span className=\"text-xs text-zinc-600\">{byStage[key].length}</span>\n            </div>\n            <div className=\"p-3 space-y-2 min-h-[100px]\">\n              {byStage[key].length === 0 && (\n                <p className=\"text-[11px] text-zinc-700 text-center pt-3\">Empty</p>\n              )}\n              {byStage[key].map((deal: any) => (\n                <Link key={deal.id} href={`/admin/clients/${deal.client_id}`}\n                  className=\"block bg-zinc-800 border border-zinc-700 hover:border-zinc-600 px-3 py-2.5 transition-colors\">\n                  <p className=\"text-sm font-semibold text-white leading-tight\">{deal.title}</p>\n                  <p className=\"text-[11px] text-zinc-500 mt-0.5\">{deal.client_name}</p>\n                  {deal.value && (\n                    <p className=\"text-[11px] text-zinc-400 mt-1\">£{parseFloat(deal.value).toLocaleString()}</p>\n                  )}\n                </Link>\n              ))}\n            </div>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"+WAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEA,IAAM,EAAS,CACb,CAAE,IAAK,OAAgB,MAAO,OAAgB,MAAO,iBAAkB,EACvE,CAAE,IAAK,YAAgB,MAAO,YAAgB,MAAO,iBAAkB,EACvE,CAAE,IAAK,WAAgB,MAAO,WAAgB,MAAO,mBAAoB,EACzE,CAAE,IAAK,cAAgB,MAAO,cAAgB,MAAO,mBAAoB,EACzE,CAAE,IAAK,aAAgB,MAAO,MAAgB,MAAO,kBAAmB,EACxE,CAAE,IAAK,cAAgB,MAAO,OAAgB,MAAO,iBAAkB,EACxE,CAEc,eAAe,IAC5B,MAAM,CAAA,EAAA,EAAA,YAAA,AAAY,IAElB,IAAM,EAAQ,MAAM,EAAA,OAAG,CAAC;;;;;EAKxB,CAAC,CAEK,EAAU,EAAO,MAAM,CAAC,CAAC,EAA4B,KACzD,CAAG,CAAC,EAAE,GAAG,CAAC,CAAG,EAAM,MAAM,CAAC,AAAC,GAAW,EAAE,KAAK,GAAK,EAAE,GAAG,EAChD,GACN,CAAC,GAEE,EAAY,EAAM,MAAM,CAAC,AAAC,GAAW,CAAC,CAAC,aAAa,cAAc,CAAC,QAAQ,CAAC,EAAE,KAAK,GACnF,EAAa,EAAU,MAAM,CAAC,CAAC,EAAa,IAAW,EAAM,WAAW,EAAE,KAAK,EAAI,GAAI,GAE7F,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,gBACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,iBACb,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,8GAAqG,aAGrH,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,4EAAmE,cAGjF,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAU,uCACV,EAAU,MAAM,CAAC,kBAAgB,CAAC,EAAa,GAAA,CAAI,CAAE,OAAO,CAAC,GAAG,yBAIrE,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,gEACZ,EAAO,GAAG,CAAC,CAAC,KAAE,CAAG,OAAE,CAAK,OAAE,CAAK,CAAE,GAChC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAc,UAAW,CAAC,uBAAuB,EAAE,EAAM,kCAAkC,CAAC,WAC3F,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,iFACb,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,wEAAgE,IAChF,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,iCAAyB,CAAO,CAAC,EAAI,CAAC,MAAM,MAE9D,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,wCACY,IAAxB,CAAO,CAAC,EAAI,CAAC,MAAM,EAClB,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,sDAA6C,UAE3D,CAAO,CAAC,EAAI,CAAC,GAAG,CAAC,AAAC,GACjB,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,OAAI,CAAA,CAAe,KAAM,CAAC,eAAe,EAAE,EAAK,SAAS,CAAA,CAAE,CAC1D,UAAU,yGACV,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,0DAAkD,EAAK,KAAK,GACzE,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,4CAAoC,EAAK,WAAW,GAChE,EAAK,KAAK,EACT,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAU,2CAAiC,IAAE,WAAW,EAAK,KAAK,EAAE,cAAc,QAL9E,EAAK,EAAE,QAVd,QAyBpB"}