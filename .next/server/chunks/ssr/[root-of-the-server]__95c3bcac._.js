module.exports=[93695,(a,b,c)=>{b.exports=a.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},70864,a=>{a.n(a.i(33290))},43619,a=>{a.n(a.i(79962))},13718,a=>{a.n(a.i(85523))},18198,a=>{a.n(a.i(45518))},62212,a=>{a.n(a.i(66114))},67971,a=>{a.n(a.i(26435))},77339,a=>{"use strict";var b=a.i(7997),c=a.i(53058),d=a.i(12259),e=a.i(95936);async function f(){await (0,c.requireAdmin)();let a=await d.default`
    SELECT
      c.id,
      c.name,
      MAX(m.created_at) as last_message_at,
      COUNT(m.id) FILTER (WHERE m.sender_role = 'client' AND m.read_at IS NULL) as unread_count,
      (SELECT body FROM messages m2 WHERE m2.client_id = c.id ORDER BY m2.created_at DESC LIMIT 1) as last_body
    FROM clients c
    LEFT JOIN messages m ON m.client_id = c.id
    GROUP BY c.id, c.name
    HAVING COUNT(m.id) > 0
    ORDER BY last_message_at DESC NULLS LAST
  `;return(0,b.jsxs)("div",{className:"p-8 max-w-3xl",children:[(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsx)("span",{className:"inline-block bg-red-700 text-white text-[9px] font-black uppercase tracking-[0.2em] px-2 py-1 mb-3",children:"Messages"}),(0,b.jsx)("h1",{className:"text-3xl font-black tracking-tighter text-white uppercase italic",children:"All Threads"}),(0,b.jsxs)("p",{className:"text-zinc-500 text-sm mt-1",children:[a.length," active conversation",1!==a.length?"s":""]})]}),(0,b.jsxs)("div",{className:"bg-zinc-900 border border-zinc-800",children:[0===a.length&&(0,b.jsx)("p",{className:"text-zinc-600 text-sm text-center py-12",children:"No messages yet"}),(0,b.jsx)("div",{className:"divide-y divide-zinc-800",children:a.map(a=>(0,b.jsxs)(e.default,{href:`/admin/clients/${a.id}`,className:"group flex items-center justify-between px-6 py-4 hover:bg-zinc-800 transition-colors",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3 min-w-0",children:[(0,b.jsxs)("div",{className:"relative shrink-0",children:[(0,b.jsx)("div",{className:"w-9 h-9 bg-zinc-700 flex items-center justify-center text-white text-sm font-black",children:a.name[0].toUpperCase()}),parseInt(a.unread_count)>0&&(0,b.jsx)("span",{className:"absolute -top-1 -right-1 bg-red-700 text-white text-[9px] font-black rounded-full w-4 h-4 flex items-center justify-center",children:a.unread_count})]}),(0,b.jsxs)("div",{className:"min-w-0",children:[(0,b.jsx)("p",{className:"text-sm font-semibold text-white",children:a.name}),a.last_body&&(0,b.jsx)("p",{className:"text-[11px] text-zinc-500 truncate",children:a.last_body})]})]}),(0,b.jsx)("div",{className:"shrink-0 ml-4 text-right",children:a.last_message_at&&(0,b.jsx)("p",{className:"text-[10px] text-zinc-600",children:new Date(a.last_message_at).toLocaleDateString("en-GB",{day:"numeric",month:"short"})})})]},a.id))})]})]})}a.s(["default",()=>f])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__95c3bcac._.js.map