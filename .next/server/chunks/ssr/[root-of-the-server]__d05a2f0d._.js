module.exports=[93695,(a,b,c)=>{b.exports=a.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},70864,a=>{a.n(a.i(33290))},43619,a=>{a.n(a.i(79962))},13718,a=>{a.n(a.i(85523))},18198,a=>{a.n(a.i(45518))},62212,a=>{a.n(a.i(66114))},22882,a=>{a.n(a.i(46927))},92737,a=>{"use strict";let b=(0,a.i(1269).default)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);a.s(["ArrowRight",()=>b],92737)},75403,a=>{"use strict";var b=a.i(7997),c=a.i(53058),d=a.i(12259),e=a.i(95936),f=a.i(92737),g=a.i(85791),h=a.i(71348),i=a.i(84674),j=a.i(1269);let k=(0,j.default)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),l=(0,j.default)("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]),m={lead:"Lead",qualified:"Qualified",proposal:"Proposal",negotiation:"Negotiation",closed_won:"Won",closed_lost:"Lost"},n={lead:"bg-zinc-700",qualified:"bg-blue-700",proposal:"bg-yellow-600",negotiation:"bg-orange-600",closed_won:"bg-green-700",closed_lost:"bg-zinc-600"};async function o(a){let j=await a.searchParams,o=await (0,c.requireAuth)(),p=await (0,c.getAppUser)({id:o.id,email:o.email,name:o.name,image:o.image}),q=(await d.default`
    SELECT c.* FROM clients c
    JOIN client_users cu ON cu.client_id = c.id
    WHERE cu.user_id = ${p.id}
    LIMIT 1
  `)[0]??null,r=q?await d.default`SELECT * FROM pipeline_deals WHERE client_id = ${q.id} ORDER BY created_at DESC LIMIT 10`:[],s=q?await d.default`SELECT COUNT(*) as count FROM messages WHERE client_id = ${q.id} AND sender_role = 'admin' AND read_at IS NULL`:[{count:"0"}],t=q?await d.default`SELECT COUNT(*) as count FROM documents WHERE client_id = ${q.id}`:[{count:"0"}],u=r.reduce((a,b)=>a+parseFloat(b.value||"0"),0);return r.filter(a=>"closed_won"===a.stage),(0,b.jsxs)("div",{className:"p-8 max-w-5xl",children:["denied"===j.admin&&(0,b.jsxs)("div",{className:"mb-6 flex items-center gap-3 bg-amber-50 border border-amber-200 rounded-lg px-4 py-3",children:[(0,b.jsx)(l,{className:"w-5 h-5 text-amber-600 shrink-0"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-semibold text-amber-900",children:"Admin access not granted"}),(0,b.jsxs)("p",{className:"text-xs text-amber-800 mt-0.5",children:['You were sent here because your account role is "',p.role,'", not "admin". Only allowed admin emails get the Admin panel. Your email: ',p.email]})]})]}),(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsx)("span",{className:"inline-block bg-red-600 text-white text-[9px] font-black uppercase tracking-[0.2em] px-2 py-1 mb-3",children:"Dashboard"}),(0,b.jsxs)("h1",{className:"text-3xl font-black tracking-tighter text-zinc-900 uppercase italic",children:["Welcome back",p.name?`, ${p.name.split(" ")[0]}`:"","."]}),q&&(0,b.jsx)("p",{className:"text-zinc-600 text-sm mt-1",children:q.name})]}),!q&&(0,b.jsx)("div",{className:"bg-white border border-zinc-200 rounded-lg p-6 mb-8 shadow-sm",children:(0,b.jsx)("p",{className:"text-zinc-600 text-sm",children:"Your account is pending client assignment. The Convivia24 team will link your pipeline shortly."})}),(0,b.jsx)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[{label:"Active Deals",value:r.filter(a=>!["closed_won","closed_lost"].includes(a.stage)).length,icon:g.GitBranch},{label:"Total Value",value:`\xa3${(u/1e3).toFixed(0)}k`,icon:k},{label:"Unread Messages",value:Number(s[0]?.count??0),icon:h.MessageSquare},{label:"Documents",value:Number(t[0]?.count??0),icon:i.FileText}].map(({label:a,value:c,icon:d})=>(0,b.jsxs)("div",{className:"bg-white border border-zinc-200 rounded-lg p-5 shadow-sm",children:[(0,b.jsx)(d,{size:16,className:"text-red-600 mb-3"}),(0,b.jsx)("p",{className:"text-2xl font-black text-zinc-900 tracking-tighter",children:c}),(0,b.jsx)("p",{className:"text-[11px] text-zinc-500 uppercase tracking-[0.15em] mt-1",children:a})]},a))}),r.length>0&&(0,b.jsxs)("div",{className:"bg-white border border-zinc-200 rounded-lg mb-6 shadow-sm",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b border-zinc-200",children:[(0,b.jsx)("h2",{className:"text-sm font-black uppercase tracking-[0.15em] text-zinc-900",children:"Recent Deals"}),(0,b.jsxs)(e.default,{href:"/dashboard/pipeline",className:"text-[11px] text-red-600 hover:text-red-700 flex items-center gap-1 transition-colors",children:["View all ",(0,b.jsx)(f.ArrowRight,{size:11})]})]}),(0,b.jsx)("div",{className:"divide-y divide-zinc-100",children:r.slice(0,5).map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between px-6 py-3.5",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("span",{className:`text-[9px] font-black uppercase tracking-[0.1em] text-white px-2 py-0.5 rounded ${n[a.stage]||"bg-zinc-600"}`,children:m[a.stage]||a.stage}),(0,b.jsx)("span",{className:"text-sm text-zinc-700",children:a.title})]}),a.value&&(0,b.jsxs)("span",{className:"text-sm font-semibold text-zinc-900",children:[a.currency," ",parseFloat(a.value).toLocaleString()]})]},a.id))})]}),(0,b.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[{href:"/dashboard/pipeline",label:"View Pipeline",sub:"Track your deals"},{href:"/dashboard/messages",label:"Messages",sub:"Talk to your team"},{href:"/dashboard/documents",label:"Documents",sub:"Files & reports"}].map(({href:a,label:c,sub:d})=>(0,b.jsxs)(e.default,{href:a,className:"group flex items-center justify-between bg-white border border-zinc-200 rounded-lg hover:border-red-300 hover:shadow-md px-5 py-4 transition-all",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-black uppercase tracking-[0.1em] text-zinc-900",children:c}),(0,b.jsx)("p",{className:"text-[11px] text-zinc-500 mt-0.5",children:d})]}),(0,b.jsx)(f.ArrowRight,{size:14,className:"text-zinc-400 group-hover:text-red-500 transition-colors"})]},a))})]})}a.s(["default",()=>o],75403)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__d05a2f0d._.js.map