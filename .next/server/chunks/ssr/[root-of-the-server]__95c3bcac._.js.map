{"version":3,"sources":["../../../../app/admin/messages/page.tsx"],"sourcesContent":["import { requireAdmin } from '@/lib/auth/session';\nimport sql from '@/lib/db';\nimport Link from 'next/link';\nimport { MessageSquare } from 'lucide-react';\n\nexport default async function AdminMessagesPage() {\n  await requireAdmin();\n\n  // Get all clients with their latest message and unread count\n  const threads = await sql`\n    SELECT\n      c.id,\n      c.name,\n      MAX(m.created_at) as last_message_at,\n      COUNT(m.id) FILTER (WHERE m.sender_role = 'client' AND m.read_at IS NULL) as unread_count,\n      (SELECT body FROM messages m2 WHERE m2.client_id = c.id ORDER BY m2.created_at DESC LIMIT 1) as last_body\n    FROM clients c\n    LEFT JOIN messages m ON m.client_id = c.id\n    GROUP BY c.id, c.name\n    HAVING COUNT(m.id) > 0\n    ORDER BY last_message_at DESC NULLS LAST\n  `;\n\n  return (\n    <div className=\"p-8 max-w-3xl\">\n      <div className=\"mb-8\">\n        <span className=\"inline-block bg-red-700 text-white text-[9px] font-black uppercase tracking-[0.2em] px-2 py-1 mb-3\">\n          Messages\n        </span>\n        <h1 className=\"text-3xl font-black tracking-tighter text-white uppercase italic\">\n          All Threads\n        </h1>\n        <p className=\"text-zinc-500 text-sm mt-1\">{threads.length} active conversation{threads.length !== 1 ? 's' : ''}</p>\n      </div>\n\n      <div className=\"bg-zinc-900 border border-zinc-800\">\n        {threads.length === 0 && (\n          <p className=\"text-zinc-600 text-sm text-center py-12\">No messages yet</p>\n        )}\n        <div className=\"divide-y divide-zinc-800\">\n          {threads.map((t: any) => (\n            <Link key={t.id} href={`/admin/clients/${t.id}`}\n              className=\"group flex items-center justify-between px-6 py-4 hover:bg-zinc-800 transition-colors\">\n              <div className=\"flex items-center gap-3 min-w-0\">\n                <div className=\"relative shrink-0\">\n                  <div className=\"w-9 h-9 bg-zinc-700 flex items-center justify-center text-white text-sm font-black\">\n                    {t.name[0].toUpperCase()}\n                  </div>\n                  {parseInt(t.unread_count) > 0 && (\n                    <span className=\"absolute -top-1 -right-1 bg-red-700 text-white text-[9px] font-black rounded-full w-4 h-4 flex items-center justify-center\">\n                      {t.unread_count}\n                    </span>\n                  )}\n                </div>\n                <div className=\"min-w-0\">\n                  <p className=\"text-sm font-semibold text-white\">{t.name}</p>\n                  {t.last_body && (\n                    <p className=\"text-[11px] text-zinc-500 truncate\">{t.last_body}</p>\n                  )}\n                </div>\n              </div>\n              <div className=\"shrink-0 ml-4 text-right\">\n                {t.last_message_at && (\n                  <p className=\"text-[10px] text-zinc-600\">\n                    {new Date(t.last_message_at).toLocaleDateString('en-GB', { day: 'numeric', month: 'short' })}\n                  </p>\n                )}\n              </div>\n            </Link>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"gXAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAGe,eAAe,IAC5B,MAAM,CAAA,EAAA,EAAA,YAAA,AAAY,IAGlB,IAAM,EAAU,MAAM,EAAA,OAAG,CAAC;;;;;;;;;;;;EAY1B,CAAC,CAED,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,0BACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,iBACb,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,8GAAqG,aAGrH,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,4EAAmE,gBAGjF,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAU,uCAA8B,EAAQ,MAAM,CAAC,uBAAwC,IAAnB,EAAQ,MAAM,CAAS,IAAM,SAG9G,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,+CACO,IAAnB,EAAQ,MAAM,EACb,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,mDAA0C,oBAEzD,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,oCACZ,EAAQ,GAAG,CAAC,AAAC,GACZ,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,OAAI,CAAA,CAAY,KAAM,CAAC,eAAe,EAAE,EAAE,EAAE,CAAA,CAAE,CAC7C,UAAU,kGACV,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,4CACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,8BACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,8FACZ,EAAE,IAAI,CAAC,EAAE,CAAC,WAAW,KAEvB,SAAS,EAAE,YAAY,EAAI,GAC1B,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,sIACb,EAAE,YAAY,MAIrB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,oBACb,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,4CAAoC,EAAE,IAAI,GACtD,EAAE,SAAS,EACV,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,8CAAsC,EAAE,SAAS,SAIpE,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,oCACZ,EAAE,eAAe,EAChB,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,qCACV,IAAI,KAAK,EAAE,eAAe,EAAE,kBAAkB,CAAC,QAAS,CAAE,IAAK,UAAW,MAAO,OAAQ,SAvBvF,EAAE,EAAE,UAiC3B"}