{"version":3,"sources":["../../../../app/admin/listings/%5Bid%5D/ListingAgreeForm.tsx/__nextjs-internal-proxy.mjs","../../../../app/admin/listings/%5Bid%5D/ListingMarkSoldForm.tsx/__nextjs-internal-proxy.mjs","../../../../app/admin/listings/%5Bid%5D/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ListingAgreeForm = registerClientReference(\n    function() { throw new Error(\"Attempted to call ListingAgreeForm() from the server but ListingAgreeForm is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/admin/listings/[id]/ListingAgreeForm.tsx\",\n    \"ListingAgreeForm\",\n);\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ListingMarkSoldForm = registerClientReference(\n    function() { throw new Error(\"Attempted to call ListingMarkSoldForm() from the server but ListingMarkSoldForm is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/admin/listings/[id]/ListingMarkSoldForm.tsx\",\n    \"ListingMarkSoldForm\",\n);\n","import { requireAdmin } from '@/lib/auth/session';\nimport sql from '@/lib/db';\nimport { notFound } from 'next/navigation';\nimport Link from 'next/link';\nimport { ListingAgreeForm } from './ListingAgreeForm';\nimport { ListingMarkSoldForm } from './ListingMarkSoldForm';\n\ntype ListingRow = {\n  id: string;\n  client_id: string;\n  client_name?: string;\n  title: string;\n  description?: string | null;\n  asking_price?: number | string | null;\n  currency: string;\n  commission_pct?: number | string | null;\n  status: string;\n  agreed_price?: number | string | null;\n  agreed_commission_pct?: number | string | null;\n  sold_at?: string | null;\n  sale_value?: number | string | null;\n  created_at: string;\n  updated_at: string;\n};\n\nexport default async function AdminListingDetailPage({ params }: { params: Promise<{ id: string }> }) {\n  await requireAdmin();\n  const { id } = await params;\n\n  const rows = await sql`\n    SELECT l.*, c.name as client_name\n    FROM listings l\n    JOIN clients c ON c.id = l.client_id\n    WHERE l.id = ${id}\n  `;\n  const listing = rows[0] as ListingRow | undefined;\n  if (!listing) notFound();\n\n  const STATUS_LABELS: Record<string, string> = {\n    draft: 'Draft',\n    submitted: 'Submitted',\n    price_agreed: 'Price agreed',\n    listed: 'Listed',\n    sold: 'Sold',\n    withdrawn: 'Withdrawn',\n  };\n\n  function formatPrice(value: number | string | null | undefined, currency: string): string {\n    if (value == null || value === '') return '—';\n    const n = typeof value === 'string' ? parseFloat(value) : value;\n    if (isNaN(n)) return '—';\n    return `${currency === 'GBP' ? '£' : currency + ' '}${n.toLocaleString()}`;\n  }\n\n  const commissionAmount =\n    listing.status === 'sold' &&\n    listing.sale_value != null &&\n    listing.agreed_commission_pct != null\n      ? Number(listing.sale_value) * (Number(listing.agreed_commission_pct) / 100)\n      : null;\n\n  return (\n    <div className=\"p-8 max-w-3xl\">\n      <div className=\"mb-8\">\n        <Link href=\"/admin/listings\" className=\"text-[11px] text-zinc-500 hover:text-white transition-colors mb-4 block\">\n          ← All Listings\n        </Link>\n        <span className=\"inline-block bg-red-700 text-white text-[9px] font-black uppercase tracking-[0.2em] px-2 py-1 mb-3\">\n          Listing\n        </span>\n        <h1 className=\"text-3xl font-black tracking-tighter text-white uppercase italic\">{listing.title}</h1>\n        <p className=\"text-zinc-500 text-sm mt-1\">\n          Client: <Link href={`/admin/clients/${listing.client_id}`} className=\"text-red-400 hover:text-red-300\">{listing.client_name ?? listing.client_id}</Link>\n          {' · '}\n          <span className=\"text-[10px] font-black uppercase px-2 py-0.5 rounded bg-zinc-700 text-zinc-300\">\n            {STATUS_LABELS[listing.status] ?? listing.status}\n          </span>\n        </p>\n      </div>\n\n      <div className=\"bg-zinc-900 border border-zinc-800 rounded-lg p-6 space-y-6\">\n        {listing.description && (\n          <div>\n            <h2 className=\"text-xs font-black uppercase text-zinc-500 mb-1\">Description</h2>\n            <p className=\"text-zinc-300 text-sm whitespace-pre-wrap\">{listing.description}</p>\n          </div>\n        )}\n        <div className=\"grid grid-cols-2 gap-4 text-sm\">\n          <div>\n            <p className=\"text-zinc-500 text-[11px] uppercase font-bold\">Asking price</p>\n            <p className=\"text-white\">{formatPrice(listing.asking_price, listing.currency)}</p>\n          </div>\n          <div>\n            <p className=\"text-zinc-500 text-[11px] uppercase font-bold\">Agreed price</p>\n            <p className=\"text-white\">{formatPrice(listing.agreed_price, listing.currency)}</p>\n          </div>\n          <div>\n            <p className=\"text-zinc-500 text-[11px] uppercase font-bold\">Commission %</p>\n            <p className=\"text-white\">{listing.agreed_commission_pct != null && listing.agreed_commission_pct !== '' ? `${Number(listing.agreed_commission_pct)}%` : '—'}</p>\n          </div>\n          {listing.status === 'sold' && (\n            <>\n              <div>\n                <p className=\"text-zinc-500 text-[11px] uppercase font-bold\">Sale value</p>\n                <p className=\"text-white\">{formatPrice(listing.sale_value, listing.currency)}</p>\n              </div>\n              {commissionAmount != null && (\n                <div>\n                  <p className=\"text-zinc-500 text-[11px] uppercase font-bold\">Commission earned</p>\n                  <p className=\"text-green-400\">{formatPrice(commissionAmount, listing.currency)}</p>\n                </div>\n              )}\n            </>\n          )}\n        </div>\n\n        <div className=\"pt-4 border-t border-zinc-800 flex flex-wrap gap-4\">\n          <Link\n            href={`/admin/clients/${listing.client_id}`}\n            className=\"inline-flex items-center gap-2 text-red-400 hover:text-red-300 text-sm font-semibold\"\n          >\n            Open client (Messages & deals) →\n          </Link>\n        </div>\n\n        {listing.status !== 'sold' && listing.status !== 'withdrawn' && (\n          <div className=\"pt-4 border-t border-zinc-800 space-y-6\">\n            <ListingAgreeForm listingId={id} currentStatus={listing.status} agreedPrice={listing.agreed_price} agreedCommissionPct={listing.agreed_commission_pct} currency={listing.currency} />\n            {(listing.status === 'price_agreed' || listing.status === 'listed') && (\n              <ListingMarkSoldForm listingId={id} currency={listing.currency} />\n            )}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"gYAEO,IAAM,EAAmB,CAAA,EAAA,AADhC,EAAA,CAAA,CAAA,OACgC,uBAAA,AAAuB,EACnD,WAAa,MAAM,AAAI,MAAM,8OAAgP,EAC7Q,6EACA,4EAHG,IAAM,EAAmB,CAAA,EADhC,AACgC,EADhC,CAAA,CAAA,OACgC,uBAAA,AAAuB,EACnD,WAAa,MAAM,AAAI,MAAM,8OAAgP,EAC7Q,yDACA,0ICHG,IAAM,EAAsB,CAAA,EAAA,AADnC,EAAA,CAAA,CAAA,OACmC,uBAAA,AAAuB,EACtD,WAAa,MAAM,AAAI,MAAM,oPAAsP,EACnR,gFACA,kFAHG,IAAM,EAAsB,CAAA,EAAA,AADnC,EAAA,CAAA,CAAA,OACmC,uBAAA,AAAuB,EACtD,WAAa,MAAM,AAAI,MAAM,oPAAsP,EACnR,4DACA,yHCLJ,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,MAoBe,eAAe,EAAuB,QAAE,CAAM,CAAuC,EAClG,MAAM,CAAA,EAAA,EAAA,YAAA,AAAY,IAClB,GAAM,IAAE,CAAE,CAAE,CAAG,MAAM,EAQf,EAAU,CANH,MAAM,EAAA,OAAG,CAAC;;;;iBAIR,EAAE,EAAG;EACpB,CAAC,CACmB,CAAC,EAAE,CAYvB,SAAS,EAAY,CAAyC,CAAE,CAAgB,EAC9E,GAAa,MAAT,GAA2B,KAAV,EAAc,MAAO,IAC1C,IAAM,EAAqB,UAAjB,OAAO,EAAqB,WAAW,GAAS,SAC1D,AAAI,MAAM,GAAW,CAAP,GACP,CAAA,EAAgB,QAAb,EAAqB,IAAM,EAAW,IAAA,EAAM,EAAE,cAAc,GAAA,CAAI,AAC5E,CAhBI,AAAC,GAAS,CAAA,EAAA,EAAA,QAAA,AAAQ,IAkBtB,IAAM,EACJ,AAAmB,WAAX,MAAM,EACQ,MAAtB,EAAQ,UAAU,EACe,MAAjC,EAAQ,qBAAqB,CACzB,OAAO,EAAQ,UAAU,GAAK,CAAD,MAAQ,EAAQ,qBAAqB,EAAI,GAAA,CAAG,CACzE,KAEN,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,0BACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,iBACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAI,CAAA,CAAC,KAAK,kBAAkB,UAAU,mFAA0E,mBAGjH,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,8GAAqG,YAGrH,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,4EAAoE,EAAQ,KAAK,GAC/F,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAU,uCAA6B,WAChC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAI,CAAA,CAAC,KAAM,CAAC,eAAe,EAAE,EAAQ,SAAS,CAAA,CAAE,CAAE,UAAU,2CAAmC,EAAQ,WAAW,EAAI,EAAQ,SAAS,GAC/I,MACD,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,0FACb,AArCmC,CAC5C,MAAO,QACP,UAAW,YACX,aAAc,eACd,OAAQ,SACR,KAAM,OACN,UAAW,WACb,CA8BwB,CAAC,EAAQ,MAAM,CAAC,EAAI,EAAQ,MAAM,SAKtD,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,wEACZ,EAAQ,WAAW,EAClB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,2DAAkD,gBAChE,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,qDAA6C,EAAQ,WAAW,MAGjF,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,2CACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,yDAAgD,iBAC7D,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,sBAAc,EAAY,EAAQ,YAAY,CAAE,EAAQ,QAAQ,OAE/E,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,yDAAgD,iBAC7D,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,sBAAc,EAAY,EAAQ,YAAY,CAAE,EAAQ,QAAQ,OAE/E,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,yDAAgD,iBAC7D,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,sBAA+C,MAAjC,EAAQ,qBAAqB,EAA8C,KAAlC,EAAQ,qBAAqB,CAAU,CAAA,EAAG,OAAO,EAAQ,qBAAqB,EAAE,CAAC,CAAC,CAAG,SAE1J,AAAmB,WAAX,MAAM,EACb,CAAA,EAAA,EAAA,IAAA,EAAA,EAAA,QAAA,CAAA,WACE,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,yDAAgD,eAC7D,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,sBAAc,EAAY,EAAQ,UAAU,CAAE,EAAQ,QAAQ,OAExD,MAApB,GACC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,yDAAgD,sBAC7D,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,0BAAkB,EAAY,EAAkB,EAAQ,QAAQ,aAOvF,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,8DACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAI,CAAA,CACH,KAAM,CAAC,eAAe,EAAE,EAAQ,SAAS,CAAA,CAAE,CAC3C,UAAU,gGACX,uCAKiB,SAAnB,EAAQ,MAAM,EAAkC,cAAnB,EAAQ,MAAM,EAC1C,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,oDACb,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,gBAAgB,CAAA,CAAC,UAAW,EAAI,cAAe,EAAQ,MAAM,CAAE,YAAa,EAAQ,YAAY,CAAE,oBAAqB,EAAQ,qBAAqB,CAAE,SAAU,EAAQ,QAAQ,GAChL,CAAoB,iBAAnB,EAAQ,MAAM,EAA0C,WAAnB,EAAQ,MAAM,AAAK,CAAQ,EAChE,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,mBAAmB,CAAA,CAAC,UAAW,EAAI,SAAU,EAAQ,QAAQ,WAO5E","ignoreList":[0,1]}