{"version":3,"sources":["../../../../app/dashboard/pipeline/page.tsx"],"sourcesContent":["import { requireAuth, getAppUser } from '@/lib/auth/session';\nimport sql from '@/lib/db';\n\nconst STAGES = [\n  { key: 'lead',         label: 'Lead',         color: 'border-zinc-600' },\n  { key: 'qualified',    label: 'Qualified',    color: 'border-blue-600' },\n  { key: 'proposal',     label: 'Proposal',     color: 'border-yellow-500' },\n  { key: 'negotiation',  label: 'Negotiation',  color: 'border-orange-500' },\n  { key: 'closed_won',   label: 'Won',          color: 'border-green-600' },\n  { key: 'closed_lost',  label: 'Lost',         color: 'border-zinc-700' },\n];\n\nconst STAGE_DOT: Record<string, string> = {\n  lead: 'bg-zinc-500',\n  qualified: 'bg-blue-500',\n  proposal: 'bg-yellow-500',\n  negotiation: 'bg-orange-500',\n  closed_won: 'bg-green-500',\n  closed_lost: 'bg-zinc-600',\n};\n\nexport default async function PipelinePage() {\n  const authUser = await requireAuth();\n  const appUser = await getAppUser({ id: authUser.id, email: authUser.email!, name: authUser.name, image: authUser.image });\n\n  const clientRows = await sql`\n    SELECT c.* FROM clients c\n    JOIN client_users cu ON cu.client_id = c.id\n    WHERE cu.user_id = ${appUser.id}\n    LIMIT 1\n  `;\n  const client = clientRows[0] ?? null;\n\n  const deals = client\n    ? await sql`SELECT * FROM pipeline_deals WHERE client_id = ${client.id} ORDER BY created_at DESC`\n    : [];\n\n  const byStage = STAGES.reduce((acc: Record<string, any[]>, s) => {\n    acc[s.key] = deals.filter((d: any) => d.stage === s.key);\n    return acc;\n  }, {});\n\n  return (\n    <div className=\"p-8\">\n      <div className=\"mb-8\">\n        <span className=\"inline-block bg-red-600 text-white text-[9px] font-black uppercase tracking-[0.2em] px-2 py-1 mb-3\">\n          Pipeline\n        </span>\n        <h1 className=\"text-3xl font-black tracking-tighter text-zinc-900 uppercase italic\">\n          Your Deals\n        </h1>\n        <p className=\"text-zinc-600 text-sm mt-1\">\n          {deals.length} deal{deals.length !== 1 ? 's' : ''} across {STAGES.length} stages\n        </p>\n      </div>\n\n      {!client ? (\n        <div className=\"bg-white border border-zinc-200 rounded-lg p-6 shadow-sm\">\n          <p className=\"text-zinc-600 text-sm\">No pipeline linked yet. Contact your account manager.</p>\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4\">\n          {STAGES.map(({ key, label, color }) => (\n            <div key={key} className={`bg-white border-t-4 ${color} border-x border-b border-zinc-200 rounded-lg shadow-sm`}>\n              <div className=\"px-4 py-3 border-b border-zinc-100 flex items-center justify-between\">\n                <div className=\"flex items-center gap-2\">\n                  <span className={`w-2 h-2 rounded-full ${STAGE_DOT[key]}`} />\n                  <span className=\"text-xs font-black uppercase tracking-[0.15em] text-zinc-600\">{label}</span>\n                </div>\n                <span className=\"text-xs text-zinc-500\">{byStage[key].length}</span>\n              </div>\n              <div className=\"p-3 space-y-2 min-h-[120px]\">\n                {byStage[key].length === 0 && (\n                  <p className=\"text-[11px] text-zinc-500 text-center pt-4\">No deals</p>\n                )}\n                {byStage[key].map((deal: any) => (\n                  <div key={deal.id} className=\"bg-zinc-50 border border-zinc-200 rounded px-3 py-2.5\">\n                    <p className=\"text-sm font-semibold text-zinc-900 leading-tight\">{deal.title}</p>\n                    {deal.value && (\n                      <p className=\"text-xs text-zinc-500 mt-1\">\n                        {deal.currency} {parseFloat(deal.value).toLocaleString()}\n                      </p>\n                    )}\n                    {deal.notes && (\n                      <p className=\"text-[11px] text-zinc-600 mt-1 line-clamp-2\">{deal.notes}</p>\n                    )}\n                    {deal.due_date && (\n                      <p className=\"text-[10px] text-zinc-600 mt-1\">\n                        Due {new Date(deal.due_date).toLocaleDateString('en-GB', { day: 'numeric', month: 'short' })}\n                      </p>\n                    )}\n                  </div>\n                ))}\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}